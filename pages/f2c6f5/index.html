<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Mockito 快速入门 | JAVA-TUTORIAL</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/java-tutorial/img/favicon.ico">
    <script src="https://cdn.wwads.cn/js/makemoney.js" type="text/javascript"></script>
    <meta name="description" content="☕ java-tutorial 是一个 Java 教程，汇集一个老司机在 Java 领域的十年积累。">
    <meta name="keywords" content="vuepress,theme,blog,vdoing">
    <meta name="theme-color" content="#11a8cd">
    <meta name="wwads-cn-verify" content="mxqWx62nfQQ9ocT4e5DzISHzOWyF4s">
    
    <link rel="preload" href="/java-tutorial/assets/css/0.styles.22aad9ca.css" as="style"><link rel="preload" href="/java-tutorial/assets/js/app.daf69751.js" as="script"><link rel="preload" href="/java-tutorial/assets/js/2.bc9223e0.js" as="script"><link rel="preload" href="/java-tutorial/assets/js/50.b5439840.js" as="script"><link rel="prefetch" href="/java-tutorial/assets/js/10.9edf914b.js"><link rel="prefetch" href="/java-tutorial/assets/js/100.ccc9a903.js"><link rel="prefetch" href="/java-tutorial/assets/js/101.183df0d3.js"><link rel="prefetch" href="/java-tutorial/assets/js/102.72154a73.js"><link rel="prefetch" href="/java-tutorial/assets/js/103.e83801db.js"><link rel="prefetch" href="/java-tutorial/assets/js/104.37a7b1ee.js"><link rel="prefetch" href="/java-tutorial/assets/js/105.2f58df41.js"><link rel="prefetch" href="/java-tutorial/assets/js/106.a9afdc16.js"><link rel="prefetch" href="/java-tutorial/assets/js/107.a78ef136.js"><link rel="prefetch" href="/java-tutorial/assets/js/108.2b5c1e35.js"><link rel="prefetch" href="/java-tutorial/assets/js/109.3e36e9e8.js"><link rel="prefetch" href="/java-tutorial/assets/js/11.f9f5b03a.js"><link rel="prefetch" href="/java-tutorial/assets/js/110.38a5c579.js"><link rel="prefetch" href="/java-tutorial/assets/js/111.b42b4984.js"><link rel="prefetch" href="/java-tutorial/assets/js/112.a6fdaf7c.js"><link rel="prefetch" href="/java-tutorial/assets/js/113.977f8481.js"><link rel="prefetch" href="/java-tutorial/assets/js/114.c37d8374.js"><link rel="prefetch" href="/java-tutorial/assets/js/115.adbb31d7.js"><link rel="prefetch" href="/java-tutorial/assets/js/116.e53d9383.js"><link rel="prefetch" href="/java-tutorial/assets/js/117.bc43cd18.js"><link rel="prefetch" href="/java-tutorial/assets/js/118.80cf3c9b.js"><link rel="prefetch" href="/java-tutorial/assets/js/119.17d1d3ef.js"><link rel="prefetch" href="/java-tutorial/assets/js/12.5c15bdc6.js"><link rel="prefetch" href="/java-tutorial/assets/js/120.fb2ee254.js"><link rel="prefetch" href="/java-tutorial/assets/js/121.f36932f6.js"><link rel="prefetch" href="/java-tutorial/assets/js/122.cf1fe750.js"><link rel="prefetch" href="/java-tutorial/assets/js/123.7dd5179b.js"><link rel="prefetch" href="/java-tutorial/assets/js/124.b11f012a.js"><link rel="prefetch" href="/java-tutorial/assets/js/125.10278b2b.js"><link rel="prefetch" href="/java-tutorial/assets/js/126.ab14f44c.js"><link rel="prefetch" href="/java-tutorial/assets/js/127.5ba17976.js"><link rel="prefetch" href="/java-tutorial/assets/js/128.af3c1a70.js"><link rel="prefetch" href="/java-tutorial/assets/js/129.ace640fd.js"><link rel="prefetch" href="/java-tutorial/assets/js/13.581f93fb.js"><link rel="prefetch" href="/java-tutorial/assets/js/130.f9a86620.js"><link rel="prefetch" href="/java-tutorial/assets/js/131.45c339b9.js"><link rel="prefetch" href="/java-tutorial/assets/js/132.4c2730f0.js"><link rel="prefetch" href="/java-tutorial/assets/js/133.c65beba5.js"><link rel="prefetch" href="/java-tutorial/assets/js/134.41643697.js"><link rel="prefetch" href="/java-tutorial/assets/js/135.4c938701.js"><link rel="prefetch" href="/java-tutorial/assets/js/136.f32614a8.js"><link rel="prefetch" href="/java-tutorial/assets/js/137.79410813.js"><link rel="prefetch" href="/java-tutorial/assets/js/14.67210f72.js"><link rel="prefetch" href="/java-tutorial/assets/js/15.f02a1ad1.js"><link rel="prefetch" href="/java-tutorial/assets/js/16.e64fab55.js"><link rel="prefetch" href="/java-tutorial/assets/js/17.e6ca686c.js"><link rel="prefetch" href="/java-tutorial/assets/js/18.8f0b0ab4.js"><link rel="prefetch" href="/java-tutorial/assets/js/19.091524f7.js"><link rel="prefetch" href="/java-tutorial/assets/js/20.b2650a4f.js"><link rel="prefetch" href="/java-tutorial/assets/js/21.1df4f842.js"><link rel="prefetch" href="/java-tutorial/assets/js/22.bbf93466.js"><link rel="prefetch" href="/java-tutorial/assets/js/23.e5a6c9e1.js"><link rel="prefetch" href="/java-tutorial/assets/js/24.7a6a1ab1.js"><link rel="prefetch" href="/java-tutorial/assets/js/25.05ce92da.js"><link rel="prefetch" href="/java-tutorial/assets/js/26.cc0a008a.js"><link rel="prefetch" href="/java-tutorial/assets/js/27.19032685.js"><link rel="prefetch" href="/java-tutorial/assets/js/28.b2bb31ab.js"><link rel="prefetch" href="/java-tutorial/assets/js/29.e89cf580.js"><link rel="prefetch" href="/java-tutorial/assets/js/3.1f5cc974.js"><link rel="prefetch" href="/java-tutorial/assets/js/30.e72522ac.js"><link rel="prefetch" href="/java-tutorial/assets/js/31.23bc8c03.js"><link rel="prefetch" href="/java-tutorial/assets/js/32.b536a066.js"><link rel="prefetch" href="/java-tutorial/assets/js/33.ebee4849.js"><link rel="prefetch" href="/java-tutorial/assets/js/34.c85865c5.js"><link rel="prefetch" href="/java-tutorial/assets/js/35.ebc1fb00.js"><link rel="prefetch" href="/java-tutorial/assets/js/36.68e02904.js"><link rel="prefetch" href="/java-tutorial/assets/js/37.674930ad.js"><link rel="prefetch" href="/java-tutorial/assets/js/38.8d6a8a9f.js"><link rel="prefetch" href="/java-tutorial/assets/js/39.797eb403.js"><link rel="prefetch" href="/java-tutorial/assets/js/4.d163695c.js"><link rel="prefetch" href="/java-tutorial/assets/js/40.d28b7496.js"><link rel="prefetch" href="/java-tutorial/assets/js/41.ce6ca6c6.js"><link rel="prefetch" href="/java-tutorial/assets/js/42.273291d5.js"><link rel="prefetch" href="/java-tutorial/assets/js/43.5e461285.js"><link rel="prefetch" href="/java-tutorial/assets/js/44.971cad76.js"><link rel="prefetch" href="/java-tutorial/assets/js/45.8e0c71aa.js"><link rel="prefetch" href="/java-tutorial/assets/js/46.f5577b26.js"><link rel="prefetch" href="/java-tutorial/assets/js/47.f71cc3c9.js"><link rel="prefetch" href="/java-tutorial/assets/js/48.a8578d32.js"><link rel="prefetch" href="/java-tutorial/assets/js/49.0e290971.js"><link rel="prefetch" href="/java-tutorial/assets/js/5.cf5cb583.js"><link rel="prefetch" href="/java-tutorial/assets/js/51.3afc4e67.js"><link rel="prefetch" href="/java-tutorial/assets/js/52.52ce1139.js"><link rel="prefetch" href="/java-tutorial/assets/js/53.e1cc5362.js"><link rel="prefetch" href="/java-tutorial/assets/js/54.fd9608e5.js"><link rel="prefetch" href="/java-tutorial/assets/js/55.632b6016.js"><link rel="prefetch" href="/java-tutorial/assets/js/56.e9aa4eea.js"><link rel="prefetch" href="/java-tutorial/assets/js/57.c0d1542e.js"><link rel="prefetch" href="/java-tutorial/assets/js/58.bc0f7c1c.js"><link rel="prefetch" href="/java-tutorial/assets/js/59.36b207a0.js"><link rel="prefetch" href="/java-tutorial/assets/js/6.d144eb92.js"><link rel="prefetch" href="/java-tutorial/assets/js/60.89446b88.js"><link rel="prefetch" href="/java-tutorial/assets/js/61.f110e04e.js"><link rel="prefetch" href="/java-tutorial/assets/js/62.62d349c4.js"><link rel="prefetch" href="/java-tutorial/assets/js/63.834fb95c.js"><link rel="prefetch" href="/java-tutorial/assets/js/64.e0fa19b4.js"><link rel="prefetch" href="/java-tutorial/assets/js/65.ff3773a7.js"><link rel="prefetch" href="/java-tutorial/assets/js/66.45b99ef4.js"><link rel="prefetch" href="/java-tutorial/assets/js/67.8ad9ddbe.js"><link rel="prefetch" href="/java-tutorial/assets/js/68.a0b09a76.js"><link rel="prefetch" href="/java-tutorial/assets/js/69.bc43b589.js"><link rel="prefetch" href="/java-tutorial/assets/js/7.f2dc074f.js"><link rel="prefetch" href="/java-tutorial/assets/js/70.38a10912.js"><link rel="prefetch" href="/java-tutorial/assets/js/71.fe10a220.js"><link rel="prefetch" href="/java-tutorial/assets/js/72.0c0ade29.js"><link rel="prefetch" href="/java-tutorial/assets/js/73.fbe5d03a.js"><link rel="prefetch" href="/java-tutorial/assets/js/74.f058f74c.js"><link rel="prefetch" href="/java-tutorial/assets/js/75.de33a550.js"><link rel="prefetch" href="/java-tutorial/assets/js/76.e3fbc3d6.js"><link rel="prefetch" href="/java-tutorial/assets/js/77.15bc7ae4.js"><link rel="prefetch" href="/java-tutorial/assets/js/78.c9176f76.js"><link rel="prefetch" href="/java-tutorial/assets/js/79.a8e94c89.js"><link rel="prefetch" href="/java-tutorial/assets/js/8.e2e9dd66.js"><link rel="prefetch" href="/java-tutorial/assets/js/80.88799756.js"><link rel="prefetch" href="/java-tutorial/assets/js/81.02a75d13.js"><link rel="prefetch" href="/java-tutorial/assets/js/82.26bfc230.js"><link rel="prefetch" href="/java-tutorial/assets/js/83.ef23783d.js"><link rel="prefetch" href="/java-tutorial/assets/js/84.7768ab87.js"><link rel="prefetch" href="/java-tutorial/assets/js/85.166bc923.js"><link rel="prefetch" href="/java-tutorial/assets/js/86.a0082b69.js"><link rel="prefetch" href="/java-tutorial/assets/js/87.f1a7edaf.js"><link rel="prefetch" href="/java-tutorial/assets/js/88.280451ae.js"><link rel="prefetch" href="/java-tutorial/assets/js/89.c22d4323.js"><link rel="prefetch" href="/java-tutorial/assets/js/9.9ce755cc.js"><link rel="prefetch" href="/java-tutorial/assets/js/90.c3ef04cb.js"><link rel="prefetch" href="/java-tutorial/assets/js/91.af01336c.js"><link rel="prefetch" href="/java-tutorial/assets/js/92.6459c6be.js"><link rel="prefetch" href="/java-tutorial/assets/js/93.366fa5d5.js"><link rel="prefetch" href="/java-tutorial/assets/js/94.29bb3af2.js"><link rel="prefetch" href="/java-tutorial/assets/js/95.c8acb7ef.js"><link rel="prefetch" href="/java-tutorial/assets/js/96.02c8387a.js"><link rel="prefetch" href="/java-tutorial/assets/js/97.f3fe9a9b.js"><link rel="prefetch" href="/java-tutorial/assets/js/98.0158ff39.js"><link rel="prefetch" href="/java-tutorial/assets/js/99.d9478ffd.js">
    <link rel="stylesheet" href="/java-tutorial/assets/css/0.styles.22aad9ca.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/java-tutorial/" class="home-link router-link-active"><img src="https://raw.githubusercontent.com/dunwu/images/master/common/dunwu-logo.png" alt="JAVA-TUTORIAL" class="logo"> <span class="site-name can-hide">JAVA-TUTORIAL</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/java-tutorial/" class="nav-link">首页</a></div><div class="nav-item"><a href="/java-tutorial/01.Java/02.JavaEE/" class="nav-link">JavaEE</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java软件" class="dropdown-title"><a href="/java-tutorial/01.Java/11.软件/" class="link-title">Java软件</a> <span class="title" style="display:none;">Java软件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/java-tutorial/01.Java/11.软件/01.构建/" class="nav-link">Java 构建</a></li><li class="dropdown-item"><!----> <a href="/java-tutorial/01.Java/11.软件/02.IDE/" class="nav-link">Java IDE</a></li><li class="dropdown-item"><!----> <a href="/java-tutorial/01.Java/11.软件/03.监控诊断/" class="nav-link">Java 监控诊断</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java工具" class="dropdown-title"><a href="/java-tutorial/01.Java/12.工具/" class="link-title">Java工具</a> <span class="title" style="display:none;">Java工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/java-tutorial/01.Java/12.工具/01.IO/" class="nav-link">Java IO 工具</a></li><li class="dropdown-item"><!----> <a href="/java-tutorial/01.Java/12.工具/02.JavaBean/" class="nav-link">JavaBean 工具</a></li><li class="dropdown-item"><!----> <a href="/java-tutorial/01.Java/12.工具/03.模板引擎/" class="nav-link">Java 模板引擎</a></li><li class="dropdown-item"><!----> <a href="/java-tutorial/01.Java/12.工具/04.测试/" class="nav-link">Java 测试工具</a></li></ul></div></div><div class="nav-item"><a href="/java-tutorial/01.Java/13.框架/" class="nav-link">Java框架</a></div><div class="nav-item"><a href="/java-tutorial/01.Java/14.中间件/" class="nav-link">Java中间件</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><!----> <span class="title" style="display:;">✨ Java系列</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/java-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Java 教程 📚
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/javacore/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JavaCore 教程 📚
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <a href="https://github.com/dunwu/java-tutorial" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/java-tutorial/" class="nav-link">首页</a></div><div class="nav-item"><a href="/java-tutorial/01.Java/02.JavaEE/" class="nav-link">JavaEE</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java软件" class="dropdown-title"><a href="/java-tutorial/01.Java/11.软件/" class="link-title">Java软件</a> <span class="title" style="display:none;">Java软件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/java-tutorial/01.Java/11.软件/01.构建/" class="nav-link">Java 构建</a></li><li class="dropdown-item"><!----> <a href="/java-tutorial/01.Java/11.软件/02.IDE/" class="nav-link">Java IDE</a></li><li class="dropdown-item"><!----> <a href="/java-tutorial/01.Java/11.软件/03.监控诊断/" class="nav-link">Java 监控诊断</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java工具" class="dropdown-title"><a href="/java-tutorial/01.Java/12.工具/" class="link-title">Java工具</a> <span class="title" style="display:none;">Java工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/java-tutorial/01.Java/12.工具/01.IO/" class="nav-link">Java IO 工具</a></li><li class="dropdown-item"><!----> <a href="/java-tutorial/01.Java/12.工具/02.JavaBean/" class="nav-link">JavaBean 工具</a></li><li class="dropdown-item"><!----> <a href="/java-tutorial/01.Java/12.工具/03.模板引擎/" class="nav-link">Java 模板引擎</a></li><li class="dropdown-item"><!----> <a href="/java-tutorial/01.Java/12.工具/04.测试/" class="nav-link">Java 测试工具</a></li></ul></div></div><div class="nav-item"><a href="/java-tutorial/01.Java/13.框架/" class="nav-link">Java框架</a></div><div class="nav-item"><a href="/java-tutorial/01.Java/14.中间件/" class="nav-link">Java中间件</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><!----> <span class="title" style="display:;">✨ Java系列</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/java-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Java 教程 📚
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/javacore/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JavaCore 教程 📚
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <a href="https://github.com/dunwu/java-tutorial" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaEE</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>软件</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>工具</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>IO</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>JavaBean</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>模板引擎</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>测试</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/java-tutorial/pages/b39f47/" class="sidebar-link">JUnit5 快速入门</a></li><li><a href="/java-tutorial/pages/f2c6f5/" aria-current="page" class="active sidebar-link">Mockito 快速入门</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/java-tutorial/pages/f2c6f5/#预备知识" class="sidebar-link">预备知识</a></li><li class="sidebar-sub-header level2"><a href="/java-tutorial/pages/f2c6f5/#使用-mock-对象来进行测试" class="sidebar-link">使用 mock 对象来进行测试</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/java-tutorial/pages/f2c6f5/#单元测试的目标和挑战" class="sidebar-link">单元测试的目标和挑战</a></li><li class="sidebar-sub-header level3"><a href="/java-tutorial/pages/f2c6f5/#测试类的分类" class="sidebar-link">测试类的分类</a></li><li class="sidebar-sub-header level3"><a href="/java-tutorial/pages/f2c6f5/#mock-对象的产生" class="sidebar-link">Mock 对象的产生</a></li><li class="sidebar-sub-header level3"><a href="/java-tutorial/pages/f2c6f5/#使用-mockito-生成-mock-对象" class="sidebar-link">使用 Mockito 生成 Mock 对象</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/java-tutorial/pages/f2c6f5/#为自己的项目添加-mockito-依赖" class="sidebar-link">为自己的项目添加 Mockito 依赖</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/java-tutorial/pages/f2c6f5/#在-gradle-添加-mockito-依赖" class="sidebar-link">在 Gradle 添加 Mockito 依赖</a></li><li class="sidebar-sub-header level3"><a href="/java-tutorial/pages/f2c6f5/#在-maven-添加-mockito-依赖" class="sidebar-link">在 Maven 添加 Mockito 依赖</a></li><li class="sidebar-sub-header level3"><a href="/java-tutorial/pages/f2c6f5/#在-eclipse-ide-使用-mockito" class="sidebar-link">在 Eclipse IDE 使用 Mockito</a></li><li class="sidebar-sub-header level3"><a href="/java-tutorial/pages/f2c6f5/#以-osgi-或者-eclipse-插件形式添加-mockito-依赖" class="sidebar-link">以 OSGi 或者 Eclipse 插件形式添加 Mockito 依赖</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/java-tutorial/pages/f2c6f5/#使用-mockito-api" class="sidebar-link">使用 Mockito API</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/java-tutorial/pages/f2c6f5/#静态引用" class="sidebar-link">静态引用</a></li><li class="sidebar-sub-header level3"><a href="/java-tutorial/pages/f2c6f5/#使用-mockito-创建和配置-mock-对象" class="sidebar-link">使用 Mockito 创建和配置 mock 对象</a></li><li class="sidebar-sub-header level3"><a href="/java-tutorial/pages/f2c6f5/#配置-mock" class="sidebar-link">配置 mock</a></li><li class="sidebar-sub-header level3"><a href="/java-tutorial/pages/f2c6f5/#验证-mock-对象方法是否被调用" class="sidebar-link">验证 mock 对象方法是否被调用</a></li><li class="sidebar-sub-header level3"><a href="/java-tutorial/pages/f2c6f5/#使用-spy-封装-java-对象" class="sidebar-link">使用 Spy 封装 java 对象</a></li><li class="sidebar-sub-header level3"><a href="/java-tutorial/pages/f2c6f5/#使用-injectmocks-在-mockito-中进行依赖注入" class="sidebar-link">使用 @InjectMocks 在 Mockito 中进行依赖注入</a></li><li class="sidebar-sub-header level3"><a href="/java-tutorial/pages/f2c6f5/#捕捉参数" class="sidebar-link">捕捉参数</a></li><li class="sidebar-sub-header level3"><a href="/java-tutorial/pages/f2c6f5/#mockito-的限制" class="sidebar-link">Mockito 的限制</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/java-tutorial/pages/f2c6f5/#在-android-中使用-mockito" class="sidebar-link">在 Android 中使用 Mockito</a></li><li class="sidebar-sub-header level2"><a href="/java-tutorial/pages/f2c6f5/#实例-使用-mockito-写一个-instrumented-unit-test" class="sidebar-link">实例：使用 Mockito 写一个 Instrumented Unit Test</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/java-tutorial/pages/f2c6f5/#创建一个测试的-android-应用" class="sidebar-link">创建一个测试的 Android 应用</a></li><li class="sidebar-sub-header level3"><a href="/java-tutorial/pages/f2c6f5/#在-app-build-gradle-文件中添加-mockito-依赖" class="sidebar-link">在 app/build.gradle 文件中添加 Mockito 依赖</a></li><li class="sidebar-sub-header level3"><a href="/java-tutorial/pages/f2c6f5/#创建测试" class="sidebar-link">创建测试</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/java-tutorial/pages/f2c6f5/#实例-使用-mockito-创建一个-mock-对象" class="sidebar-link">实例：使用 Mockito 创建一个 mock 对象</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/java-tutorial/pages/f2c6f5/#目标" class="sidebar-link">目标</a></li><li class="sidebar-sub-header level3"><a href="/java-tutorial/pages/f2c6f5/#创建一个-twitter-api-的例子" class="sidebar-link">创建一个 Twitter API 的例子</a></li><li class="sidebar-sub-header level3"><a href="/java-tutorial/pages/f2c6f5/#模拟-itweet-的实例" class="sidebar-link">模拟 ITweet 的实例</a></li><li class="sidebar-sub-header level3"><a href="/java-tutorial/pages/f2c6f5/#验证方法调用" class="sidebar-link">验证方法调用</a></li><li class="sidebar-sub-header level3"><a href="/java-tutorial/pages/f2c6f5/#验证" class="sidebar-link">验证</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/java-tutorial/pages/f2c6f5/#模拟静态方法" class="sidebar-link">模拟静态方法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/java-tutorial/pages/f2c6f5/#使用-powermock-来模拟静态方法" class="sidebar-link">使用 Powermock 来模拟静态方法</a></li><li class="sidebar-sub-header level3"><a href="/java-tutorial/pages/f2c6f5/#用封装的方法代替-powermock" class="sidebar-link">用封装的方法代替 Powermock</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/java-tutorial/pages/f2c6f5/#引用和引申" class="sidebar-link">引用和引申</a></li></ul></li><li><a href="/java-tutorial/pages/0e5ab1/" class="sidebar-link">JMeter 快速入门</a></li><li><a href="/java-tutorial/pages/9c6402/" class="sidebar-link">JMH 快速入门</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>其他</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>框架</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>中间件</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/java-tutorial/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/java-tutorial/categories/?category=Java" title="分类" data-v-06225672>Java</a></li><li data-v-06225672><a href="/java-tutorial/categories/?category=%E5%B7%A5%E5%85%B7" title="分类" data-v-06225672>工具</a></li><li data-v-06225672><a href="/java-tutorial/categories/?category=%E6%B5%8B%E8%AF%95" title="分类" data-v-06225672>测试</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/dunwu" target="_blank" title="作者" class="beLink" data-v-06225672>dunwu</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2022-02-17</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">Mockito 快速入门<!----></h1>  <div class="theme-vdoing-content content__default"><h1 id="mockito-快速入门"><a href="#mockito-快速入门" class="header-anchor">#</a> Mockito 快速入门</h1> <blockquote><p>Mockito 是一个针对 Java 的 mock 框架。</p></blockquote> <h2 id="预备知识"><a href="#预备知识" class="header-anchor">#</a> 预备知识</h2> <p>如果需要往下学习，你需要先理解 Junit 框架中的单元测试。</p> <p>如果你不熟悉 JUnit，请看 <a href="http://www.vogella.com/tutorials/JUnit/article.html" target="_blank" rel="noopener noreferrer">Junit 教程<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="使用-mock-对象来进行测试"><a href="#使用-mock-对象来进行测试" class="header-anchor">#</a> 使用 mock 对象来进行测试</h2> <h3 id="单元测试的目标和挑战"><a href="#单元测试的目标和挑战" class="header-anchor">#</a> 单元测试的目标和挑战</h3> <p>单元测试的思路是在不涉及依赖关系的情况下测试代码（隔离性），所以测试代码与其他类或者系统的关系应该尽量被消除。一个可行的消除方法是替换掉依赖类（测试替换），也就是说我们可以使用替身来替换掉真正的依赖对象。</p> <h3 id="测试类的分类"><a href="#测试类的分类" class="header-anchor">#</a> 测试类的分类</h3> <ul><li><strong>dummy object</strong> 做为参数传递给方法但是绝对不会被使用。譬如说，这种测试类内部的方法不会被调用，或者是用来填充某个方法的参数。</li> <li><strong>Fake</strong> 是真正接口或抽象类的实现体，但给对象内部实现很简单。譬如说，它存在内存中而不是真正的数据库中。（译者注：<strong>Fake</strong> 实现了真正的逻辑，但它的存在只是为了测试，而不适合于用在产品中。）</li> <li><strong>stub</strong> 类是依赖类的部分方法实现，而这些方法在你测试类和接口的时候会被用到，也就是说 <strong>stub</strong> 类在测试中会被实例化。<strong>stub</strong> 类会回应任何外部测试的调用。<strong>stub</strong> 类有时候还会记录调用的一些信息。</li> <li><strong>mock object</strong> 是指类或者接口的模拟实现，你可以自定义这个对象中某个方法的输出结果。</li></ul> <p>测试替代技术能够在测试中模拟测试类以外对象。因此你可以验证测试类是否响应正常。譬如说，你可以验证在 Mock 对象的某一个方法是否被调用。这可以确保隔离了外部依赖的干扰只测试测试类。</p> <p>我们选择 Mock 对象的原因是因为 Mock 对象只需要少量代码的配置。</p> <h3 id="mock-对象的产生"><a href="#mock-对象的产生" class="header-anchor">#</a> Mock 对象的产生</h3> <p>你可以手动创建一个 Mock 对象或者使用 Mock 框架来模拟这些类，Mock 框架允许你在运行时创建 Mock 对象并且定义它的行为。</p> <p>一个典型的例子是把 Mock 对象模拟成数据的提供者。在正式的生产环境中它会被实现用来连接数据源。但是我们在测试的时候 Mock 对象将会模拟成数据提供者来确保我们的测试环境始终是相同的。</p> <p>Mock 对象可以被提供来进行测试。因此，我们测试的类应该避免任何外部数据的强依赖。</p> <p>通过 Mock 对象或者 Mock 框架，我们可以测试代码中期望的行为。譬如说，验证只有某个存在 Mock 对象的方法是否被调用了。</p> <h3 id="使用-mockito-生成-mock-对象"><a href="#使用-mockito-生成-mock-对象" class="header-anchor">#</a> 使用 Mockito 生成 Mock 对象</h3> <p><em>Mockito</em> 是一个流行 mock 框架，可以和 JUnit 结合起来使用。Mockito 允许你创建和配置 mock 对象。使用 Mockito 可以明显的简化对外部依赖的测试类的开发。</p> <p>一般使用 Mockito 需要执行下面三步</p> <ol><li>模拟并替换测试代码中外部依赖</li> <li>执行测试代码</li> <li>验证测试代码是否被正确的执行 0</li></ol> <h2 id="为自己的项目添加-mockito-依赖"><a href="#为自己的项目添加-mockito-依赖" class="header-anchor">#</a> 为自己的项目添加 Mockito 依赖</h2> <h3 id="在-gradle-添加-mockito-依赖"><a href="#在-gradle-添加-mockito-依赖" class="header-anchor">#</a> 在 Gradle 添加 Mockito 依赖</h3> <p>如果你的项目使用 Gradle 构建，将下面代码加入 Gradle 的构建文件中为自己项目添加 Mockito 依赖</p> <div class="language- extra-class"><pre class="language-text"><code>repositories { jcenter() }
dependencies { testCompile &quot;org.mockito:mockito-core:2.0.57-beta&quot; }
</code></pre></div><h3 id="在-maven-添加-mockito-依赖"><a href="#在-maven-添加-mockito-依赖" class="header-anchor">#</a> 在 Maven 添加 Mockito 依赖</h3> <p>需要在 Maven 声明依赖，您可以在 <a href="http://search.maven.org/" target="_blank" rel="noopener noreferrer">http://search.maven.org<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 网站中搜索 <code>g:&quot;org.mockito&quot;, a:&quot;mockito-core&quot;</code> 来得到具体的声明方式。</p> <h3 id="在-eclipse-ide-使用-mockito"><a href="#在-eclipse-ide-使用-mockito" class="header-anchor">#</a> 在 Eclipse IDE 使用 Mockito</h3> <p>Eclipse IDE 支持 Gradle 和 Maven 两种构建工具，所以在 Eclipse IDE 添加依赖取决你使用的是哪一个构建工具。</p> <h3 id="以-osgi-或者-eclipse-插件形式添加-mockito-依赖"><a href="#以-osgi-或者-eclipse-插件形式添加-mockito-依赖" class="header-anchor">#</a> 以 OSGi 或者 Eclipse 插件形式添加 Mockito 依赖</h3> <p>在 Eclipse RCP 应用依赖通常可以在 p2 update 上得到。Orbit 是一个很好的第三方仓库，我们可以在里面寻找能在 Eclipse 上使用的应用和插件。</p> <p>Orbit 仓库地址：<a href="http://download.eclipse.org/tools/orbit/downloads" target="_blank" rel="noopener noreferrer">http://download.eclipse.org/tools/orbit/downloads<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="使用-mockito-api"><a href="#使用-mockito-api" class="header-anchor">#</a> 使用 Mockito API</h2> <h3 id="静态引用"><a href="#静态引用" class="header-anchor">#</a> 静态引用</h3> <p>如果在代码中静态引用了<code>org.mockito.Mockito.*;</code>，那你你就可以直接调用静态方法和静态变量而不用创建对象，譬如直接调用 mock() 方法。</p> <h3 id="使用-mockito-创建和配置-mock-对象"><a href="#使用-mockito-创建和配置-mock-对象" class="header-anchor">#</a> 使用 Mockito 创建和配置 mock 对象</h3> <p>除了上面所说的使用 mock() 静态方法外，Mockito 还支持通过 <code>@Mock</code> 注解的方式来创建 mock 对象。</p> <p>如果你使用注解，那么必须要实例化 mock 对象。Mockito 在遇到使用注解的字段的时候，会调用<code>MockitoAnnotations.initMocks(this)</code> 来初始化该 mock 对象。另外也可以通过使用<code>@RunWith(MockitoJUnitRunner.class)</code>来达到相同的效果。</p> <p>通过下面的例子我们可以了解到使用<code>@Mock</code> 的方法和<code>MockitoRule</code>规则。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>mockito<span class="token punctuation">.</span></span><span class="token class-name">Mockito</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MockitoTest</span>  <span class="token punctuation">{</span>

        <span class="token annotation punctuation">@Mock</span>
        <span class="token class-name">MyDatabase</span> databaseMock<span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

        <span class="token annotation punctuation">@Rule</span> <span class="token keyword">public</span> <span class="token class-name">MockitoRule</span> mockitoRule <span class="token operator">=</span> <span class="token class-name">MockitoJUnit</span><span class="token punctuation">.</span><span class="token function">rule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>

        <span class="token annotation punctuation">@Test</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>
                <span class="token class-name">ClassToTest</span> t  <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassToTest</span><span class="token punctuation">(</span>databaseMock<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
                <span class="token keyword">boolean</span> check <span class="token operator">=</span> t<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;* from t&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
                <span class="token function">assertTrue</span><span class="token punctuation">(</span>check<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
                <span class="token function">verify</span><span class="token punctuation">(</span>databaseMock<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;* from t&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ol><li>告诉 Mockito 模拟 databaseMock 实例</li> <li>Mockito 通过 @mock 注解创建 mock 对象</li> <li>使用已经创建的 mock 初始化这个类</li> <li>在测试环境下，执行测试类中的代码</li> <li>使用断言确保调用的方法返回值为 true</li> <li>验证 query 方法是否被 <code>MyDatabase</code> 的 mock 对象调用</li></ol> <h3 id="配置-mock"><a href="#配置-mock" class="header-anchor">#</a> 配置 mock</h3> <p>当我们需要配置某个方法的返回值的时候，Mockito 提供了链式的 API 供我们方便的调用</p> <p><code>when(….).thenReturn(….)</code>可以被用来定义当条件满足时函数的返回值，如果你需要定义多个返回值，可以多次定义。当你多次调用函数的时候，Mockito 会根据你定义的先后顺序来返回返回值。Mocks 还可以根据传入参数的不同来定义不同的返回值。譬如说你的函数可以将<code>anyString</code> 或者 <code>anyInt</code>作为输入参数，然后定义其特定的放回值。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>mockito<span class="token punctuation">.</span></span><span class="token class-name">Mockito</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>
        <span class="token comment">//  创建 mock</span>
        <span class="token class-name">MyClass</span> test <span class="token operator">=</span> <span class="token class-name">Mockito</span><span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token class-name">MyClass</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 自定义 getUniqueId() 的返回值</span>
        <span class="token function">when</span><span class="token punctuation">(</span>test<span class="token punctuation">.</span><span class="token function">getUniqueId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token number">43</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 在测试中使用mock对象</span>
        <span class="token function">assertEquals</span><span class="token punctuation">(</span>test<span class="token punctuation">.</span><span class="token function">getUniqueId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">43</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 返回多个值</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testMoreThanOneReturnValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>
        <span class="token class-name">Iterator</span> i<span class="token operator">=</span> <span class="token function">mock</span><span class="token punctuation">(</span><span class="token class-name">Iterator</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">when</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token string">&quot;Mockito&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token string">&quot;rocks&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> result<span class="token operator">=</span>i<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot; &quot;</span><span class="token operator">+</span>i<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 断言</span>
        <span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string">&quot;Mockito rocks&quot;</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 如何根据输入来返回值</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testReturnValueDependentOnMethodParameter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>
        <span class="token class-name">Comparable</span> c<span class="token operator">=</span> <span class="token function">mock</span><span class="token punctuation">(</span><span class="token class-name">Comparable</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">when</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token string">&quot;Mockito&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">when</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token string">&quot;Eclipse&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 断言</span>
        <span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>c<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token string">&quot;Mockito&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 如何让返回值不依赖于输入</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testReturnValueInDependentOnMethodParameter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>
        <span class="token class-name">Comparable</span> c<span class="token operator">=</span> <span class="token function">mock</span><span class="token punctuation">(</span><span class="token class-name">Comparable</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">when</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token function">anyInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 断言</span>
        <span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">,</span>c<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 根据参数类型来返回值</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testReturnValueInDependentOnMethodParameter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>
        <span class="token class-name">Comparable</span> c<span class="token operator">=</span> <span class="token function">mock</span><span class="token punctuation">(</span><span class="token class-name">Comparable</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">when</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token function">isA</span><span class="token punctuation">(</span><span class="token class-name">Todo</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 断言</span>
        <span class="token class-name">Todo</span> todo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Todo</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assertEquals</span><span class="token punctuation">(</span>todo <span class="token punctuation">,</span>c<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Todo</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>对于无返回值的函数，我们可以使用<code>doReturn(…).when(…).methodCall</code>来获得类似的效果。例如我们想在调用某些无返回值函数的时候抛出异常，那么可以使用<code>doThrow</code> 方法。如下面代码片段所示</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>mockito<span class="token punctuation">.</span></span><span class="token class-name">Mockito</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token comment">// 下面测试用例描述了如何使用doThrow()方法</span>

<span class="token annotation punctuation">@Test</span><span class="token punctuation">(</span>expected<span class="token operator">=</span><span class="token class-name">IOException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testForIOException</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 创建并配置 mock 对象</span>
        <span class="token class-name">OutputStream</span> mockStream <span class="token operator">=</span> <span class="token function">mock</span><span class="token punctuation">(</span><span class="token class-name">OutputStream</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">doThrow</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">IOException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">when</span><span class="token punctuation">(</span>mockStream<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 使用 mock</span>
        <span class="token class-name">OutputStreamWriter</span> streamWriter<span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OutputStreamWriter</span><span class="token punctuation">(</span>mockStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
        streamWriter<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="验证-mock-对象方法是否被调用"><a href="#验证-mock-对象方法是否被调用" class="header-anchor">#</a> 验证 mock 对象方法是否被调用</h3> <p>Mockito 会跟踪 mock 对象里面所有的方法和变量。所以我们可以用来验证函数在传入特定参数的时候是否被调用。这种方式的测试称行为测试，行为测试并不会检查函数的返回值，而是检查在传入正确参数时候函数是否被调用。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>mockito<span class="token punctuation">.</span></span><span class="token class-name">Mockito</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testVerify</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>
        <span class="token comment">// 创建并配置 mock 对象</span>
        <span class="token class-name">MyClass</span> test <span class="token operator">=</span> <span class="token class-name">Mockito</span><span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token class-name">MyClass</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">when</span><span class="token punctuation">(</span>test<span class="token punctuation">.</span><span class="token function">getUniqueId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token number">43</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 调用mock对象里面的方法并传入参数为12</span>
        test<span class="token punctuation">.</span><span class="token function">testing</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        test<span class="token punctuation">.</span><span class="token function">getUniqueId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        test<span class="token punctuation">.</span><span class="token function">getUniqueId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 查看在传入参数为12的时候方法是否被调用</span>
        <span class="token function">verify</span><span class="token punctuation">(</span>test<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">testing</span><span class="token punctuation">(</span><span class="token class-name">Matchers</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 方法是否被调用两次</span>
        <span class="token function">verify</span><span class="token punctuation">(</span>test<span class="token punctuation">,</span> <span class="token function">times</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getUniqueId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 其他用来验证函数是否被调用的方法</span>
        <span class="token function">verify</span><span class="token punctuation">(</span>mock<span class="token punctuation">,</span> <span class="token function">never</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">someMethod</span><span class="token punctuation">(</span><span class="token string">&quot;never called&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">verify</span><span class="token punctuation">(</span>mock<span class="token punctuation">,</span> <span class="token function">atLeastOnce</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">someMethod</span><span class="token punctuation">(</span><span class="token string">&quot;called at least once&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">verify</span><span class="token punctuation">(</span>mock<span class="token punctuation">,</span> <span class="token function">atLeast</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">someMethod</span><span class="token punctuation">(</span><span class="token string">&quot;called at least twice&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">verify</span><span class="token punctuation">(</span>mock<span class="token punctuation">,</span> <span class="token function">times</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">someMethod</span><span class="token punctuation">(</span><span class="token string">&quot;called five times&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">verify</span><span class="token punctuation">(</span>mock<span class="token punctuation">,</span> <span class="token function">atMost</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">someMethod</span><span class="token punctuation">(</span><span class="token string">&quot;called at most 3 times&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="使用-spy-封装-java-对象"><a href="#使用-spy-封装-java-对象" class="header-anchor">#</a> 使用 Spy 封装 java 对象</h3> <p>@Spy 或者<code>spy()</code>方法可以被用来封装 java 对象。被封装后，除非特殊声明（打桩 <em>stub</em>），否则都会真正的调用对象里面的每一个方法</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>mockito<span class="token punctuation">.</span></span><span class="token class-name">Mockito</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token comment">// Lets mock a LinkedList</span>
<span class="token class-name">List</span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">List</span> spy <span class="token operator">=</span> <span class="token function">spy</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 可用 doReturn() 来打桩</span>
<span class="token function">doReturn</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">when</span><span class="token punctuation">(</span>spy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 下面代码不生效</span>
<span class="token comment">// 真正的方法会被调用</span>
<span class="token comment">// 将会抛出 IndexOutOfBoundsException 的异常，因为 List 为空</span>
<span class="token function">when</span><span class="token punctuation">(</span>spy<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>方法<code>verifyNoMoreInteractions()</code>允许你检查没有其他的方法被调用了。</p> <h3 id="使用-injectmocks-在-mockito-中进行依赖注入"><a href="#使用-injectmocks-在-mockito-中进行依赖注入" class="header-anchor">#</a> 使用 @InjectMocks 在 Mockito 中进行依赖注入</h3> <p>我们也可以使用<code>@InjectMocks</code> 注解来创建对象，它会根据类型来注入对象里面的成员方法和变量。假定我们有 ArticleManager 类</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ArticleManager</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">User</span> user<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">ArticleDatabase</span> database<span class="token punctuation">;</span>

    <span class="token class-name">ArticleManager</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token keyword">this</span><span class="token punctuation">.</span>user <span class="token operator">=</span> user<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">void</span> <span class="token function">setDatabase</span><span class="token punctuation">(</span><span class="token class-name">ArticleDatabase</span> database<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这个类会被 Mockito 构造，而类的成员方法和变量都会被 mock 对象所代替，正如下面的代码片段所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">MockitoJUnitRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ArticleManagerTest</span>  <span class="token punctuation">{</span>

       <span class="token annotation punctuation">@Mock</span> <span class="token class-name">ArticleCalculator</span> calculator<span class="token punctuation">;</span>
       <span class="token annotation punctuation">@Mock</span> <span class="token class-name">ArticleDatabase</span> database<span class="token punctuation">;</span>
       <span class="token annotation punctuation">@Most</span> <span class="token class-name">User</span> user<span class="token punctuation">;</span>

       <span class="token annotation punctuation">@Spy</span> <span class="token keyword">private</span> <span class="token class-name">UserProvider</span> userProvider <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConsumerUserProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token annotation punctuation">@InjectMocks</span> <span class="token keyword">private</span> <span class="token class-name">ArticleManager</span> manager<span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

       <span class="token annotation punctuation">@Test</span> <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">shouldDoSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
               <span class="token comment">// 假定 ArticleManager 有一个叫 initialize() 的方法被调用了</span>
               <span class="token comment">// 使用 ArticleListener 来调用 addListener 方法</span>
               manager<span class="token punctuation">.</span><span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

               <span class="token comment">// 验证 addListener 方法被调用</span>
               <span class="token function">verify</span><span class="token punctuation">(</span>database<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token function">any</span><span class="token punctuation">(</span><span class="token class-name">ArticleListener</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ol><li>创建 ArticleManager 实例并注入 Mock 对象</li></ol> <p>更多的详情可以查看 <a href="http://docs.mockito.googlecode.com/hg/1.9.5/org/mockito/InjectMocks.html" target="_blank" rel="noopener noreferrer">http://docs.mockito.googlecode.com/hg/1.9.5/org/mockito/InjectMocks.html<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="捕捉参数"><a href="#捕捉参数" class="header-anchor">#</a> 捕捉参数</h3> <p><code>ArgumentCaptor</code>类允许我们在 verification 期间访问方法的参数。得到方法的参数后我们可以使用它进行测试。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>hamcrest<span class="token punctuation">.</span></span><span class="token class-name">Matchers</span><span class="token punctuation">.</span><span class="token static">hasItem</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token static">assertThat</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>mockito<span class="token punctuation">.</span></span><span class="token class-name">Mockito</span><span class="token punctuation">.</span><span class="token static">mock</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>mockito<span class="token punctuation">.</span></span><span class="token class-name">Mockito</span><span class="token punctuation">.</span><span class="token static">verify</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Arrays</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Rule</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>mockito<span class="token punctuation">.</span></span><span class="token class-name">ArgumentCaptor</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>mockito<span class="token punctuation">.</span></span><span class="token class-name">Captor</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>mockito<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">MockitoJUnit</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>mockito<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">MockitoRule</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MockitoTests</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Rule</span>
    <span class="token keyword">public</span> <span class="token class-name">MockitoRule</span> rule <span class="token operator">=</span> <span class="token class-name">MockitoJUnit</span><span class="token punctuation">.</span><span class="token function">rule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Captor</span>
    <span class="token keyword">private</span> <span class="token class-name">ArgumentCaptor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> captor<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">shouldContainCertainListItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> asList <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">&quot;someElement_test&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;someElement&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> mockedList <span class="token operator">=</span> <span class="token function">mock</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mockedList<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>asList<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">verify</span><span class="token punctuation">(</span>mockedList<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>captor<span class="token punctuation">.</span><span class="token function">capture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> capturedArgument <span class="token operator">=</span> captor<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span>capturedArgument<span class="token punctuation">,</span> <span class="token function">hasItem</span><span class="token punctuation">(</span><span class="token string">&quot;someElement&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="mockito-的限制"><a href="#mockito-的限制" class="header-anchor">#</a> Mockito 的限制</h3> <p>Mockito 当然也有一定的限制。而下面三种数据类型则不能够被测试</p> <ul><li>final classes</li> <li>anonymous classes</li> <li>primitive types</li></ul> <h2 id="在-android-中使用-mockito"><a href="#在-android-中使用-mockito" class="header-anchor">#</a> 在 Android 中使用 Mockito</h2> <p>在 Android 中的 Gradle 构建文件中加入 Mockito 依赖后就可以直接使用 Mockito 了。若想使用 Android Instrumented tests 的话，还需要添加 dexmaker 和 dexmaker-mockito 依赖到 Gradle 的构建文件中。（需要 Mockito 1.9.5 版本以上）</p> <div class="language-java extra-class"><pre class="language-java"><code>dependencies <span class="token punctuation">{</span>
    testCompile 'junit<span class="token operator">:</span>junit<span class="token operator">:</span><span class="token number">4.12</span>'
    <span class="token comment">// Mockito unit test 的依赖</span>
    testCompile 'org<span class="token punctuation">.</span>mockito<span class="token operator">:</span>mockito<span class="token operator">-</span>core<span class="token operator">:</span><span class="token number">1.</span><span class="token operator">+</span>'
    <span class="token comment">// Mockito Android instrumentation tests 的依赖</span>
    androidTestCompile 'org<span class="token punctuation">.</span>mockito<span class="token operator">:</span>mockito<span class="token operator">-</span>core<span class="token operator">:</span><span class="token number">1.</span><span class="token operator">+</span>'
    androidTestCompile <span class="token string">&quot;com.google.dexmaker:dexmaker:1.2&quot;</span>
    androidTestCompile <span class="token string">&quot;com.google.dexmaker:dexmaker-mockito:1.2&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="实例-使用-mockito-写一个-instrumented-unit-test"><a href="#实例-使用-mockito-写一个-instrumented-unit-test" class="header-anchor">#</a> 实例：使用 Mockito 写一个 Instrumented Unit Test</h2> <h3 id="创建一个测试的-android-应用"><a href="#创建一个测试的-android-应用" class="header-anchor">#</a> 创建一个测试的 Android 应用</h3> <p>创建一个包名为<code>com.vogella.android.testing.mockito.contextmock</code>的 Android 应用，添加一个静态方法 ，方法里面创建一个包含参数的 Intent，如下代码所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Intent</span> <span class="token function">createQuery</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">,</span> <span class="token class-name">String</span> query<span class="token punctuation">,</span> <span class="token class-name">String</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 简单起见，重用MainActivity</span>
    <span class="token class-name">Intent</span> i <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token class-name">MainActivity</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    i<span class="token punctuation">.</span><span class="token function">putExtra</span><span class="token punctuation">(</span><span class="token string">&quot;QUERY&quot;</span><span class="token punctuation">,</span> query<span class="token punctuation">)</span><span class="token punctuation">;</span>
    i<span class="token punctuation">.</span><span class="token function">putExtra</span><span class="token punctuation">(</span><span class="token string">&quot;VALUE&quot;</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> i<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="在-app-build-gradle-文件中添加-mockito-依赖"><a href="#在-app-build-gradle-文件中添加-mockito-依赖" class="header-anchor">#</a> 在 app/build.gradle 文件中添加 Mockito 依赖</h3> <div class="language-java extra-class"><pre class="language-java"><code>dependencies <span class="token punctuation">{</span>
    <span class="token comment">// Mockito 和 JUnit 的依赖</span>
    <span class="token comment">// instrumentation unit tests on the JVM</span>
    androidTestCompile 'junit<span class="token operator">:</span>junit<span class="token operator">:</span><span class="token number">4.12</span>'
    androidTestCompile 'org<span class="token punctuation">.</span>mockito<span class="token operator">:</span>mockito<span class="token operator">-</span>core<span class="token operator">:</span><span class="token number">2.0</span><span class="token number">.57</span><span class="token operator">-</span>beta'
    androidTestCompile 'com<span class="token punctuation">.</span>android<span class="token punctuation">.</span>support<span class="token punctuation">.</span>test<span class="token operator">:</span>runner<span class="token operator">:</span><span class="token number">0.3</span>'
    androidTestCompile <span class="token string">&quot;com.google.dexmaker:dexmaker:1.2&quot;</span>
    androidTestCompile <span class="token string">&quot;com.google.dexmaker:dexmaker-mockito:1.2&quot;</span>

    <span class="token comment">// Mockito 和 JUnit 的依赖</span>
    <span class="token comment">// tests on the JVM</span>
    testCompile 'junit<span class="token operator">:</span>junit<span class="token operator">:</span><span class="token number">4.12</span>'
    testCompile 'org<span class="token punctuation">.</span>mockito<span class="token operator">:</span>mockito<span class="token operator">-</span>core<span class="token operator">:</span><span class="token number">1.</span><span class="token operator">+</span>'

<span class="token punctuation">}</span>
</code></pre></div><h3 id="创建测试"><a href="#创建测试" class="header-anchor">#</a> 创建测试</h3> <p>使用 Mockito 创建一个单元测试来验证在传递正确 extra data 的情况下，intent 是否被触发。</p> <p>因此我们需要使用 Mockito 来 mock 一个<code>Context</code>对象，如下代码所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>vogella<span class="token punctuation">.</span>android<span class="token punctuation">.</span>testing<span class="token punctuation">.</span>mockitocontextmock</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>content<span class="token punctuation">.</span></span><span class="token class-name">Context</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>content<span class="token punctuation">.</span></span><span class="token class-name">Intent</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>os<span class="token punctuation">.</span></span><span class="token class-name">Bundle</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runner<span class="token punctuation">.</span></span><span class="token class-name">RunWith</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>mockito<span class="token punctuation">.</span></span><span class="token class-name">Mockito</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token static">assertEquals</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token static">assertNotNull</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TextIntentCreation</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testIntentShouldBeCreated</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Context</span> context <span class="token operator">=</span> <span class="token class-name">Mockito</span><span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Intent</span> intent <span class="token operator">=</span> <span class="token class-name">MainActivity</span><span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token string">&quot;query&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;value&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assertNotNull</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Bundle</span> extras <span class="token operator">=</span> intent<span class="token punctuation">.</span><span class="token function">getExtras</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assertNotNull</span><span class="token punctuation">(</span>extras<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string">&quot;query&quot;</span><span class="token punctuation">,</span> extras<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;QUERY&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string">&quot;value&quot;</span><span class="token punctuation">,</span> extras<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;VALUE&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="实例-使用-mockito-创建一个-mock-对象"><a href="#实例-使用-mockito-创建一个-mock-对象" class="header-anchor">#</a> 实例：使用 Mockito 创建一个 mock 对象</h2> <h3 id="目标"><a href="#目标" class="header-anchor">#</a> 目标</h3> <p>创建一个 Api，它可以被 Mockito 来模拟并做一些工作</p> <h3 id="创建一个-twitter-api-的例子"><a href="#创建一个-twitter-api-的例子" class="header-anchor">#</a> 创建一个 Twitter API 的例子</h3> <p>实现 <code>TwitterClient</code>类，它内部使用到了 <code>ITweet</code> 的实现。但是<code>ITweet</code>实例很难得到，譬如说他需要启动一个很复杂的服务来得到。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ITweet</span> <span class="token punctuation">{</span>

        <span class="token class-name">String</span> <span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TwitterClient</span> <span class="token punctuation">{</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendTweet</span><span class="token punctuation">(</span><span class="token class-name">ITweet</span> tweet<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">String</span> message <span class="token operator">=</span> tweet<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">// send the message to Twitter</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="模拟-itweet-的实例"><a href="#模拟-itweet-的实例" class="header-anchor">#</a> 模拟 ITweet 的实例</h3> <p>为了能够不启动复杂的服务来得到 <code>ITweet</code>，我们可以使用 Mockito 来模拟得到该实例。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSendingTweet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">TwitterClient</span> twitterClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TwitterClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">ITweet</span> iTweet <span class="token operator">=</span> <span class="token function">mock</span><span class="token punctuation">(</span><span class="token class-name">ITweet</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">when</span><span class="token punctuation">(</span>iTweet<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token string">&quot;Using mockito is great&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        twitterClient<span class="token punctuation">.</span><span class="token function">sendTweet</span><span class="token punctuation">(</span>iTweet<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>现在 <code>TwitterClient</code> 可以使用 <code>ITweet</code> 接口的实现，当调用 <code>getMessage()</code> 方法的时候将会打印 &quot;Using Mockito is great&quot; 信息。</p> <h3 id="验证方法调用"><a href="#验证方法调用" class="header-anchor">#</a> 验证方法调用</h3> <p>确保 getMessage() 方法至少调用一次。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSendingTweet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">TwitterClient</span> twitterClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TwitterClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">ITweet</span> iTweet <span class="token operator">=</span> <span class="token function">mock</span><span class="token punctuation">(</span><span class="token class-name">ITweet</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">when</span><span class="token punctuation">(</span>iTweet<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token string">&quot;Using mockito is great&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        twitterClient<span class="token punctuation">.</span><span class="token function">sendTweet</span><span class="token punctuation">(</span>iTweet<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">verify</span><span class="token punctuation">(</span>iTweet<span class="token punctuation">,</span> <span class="token function">atLeastOnce</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="验证"><a href="#验证" class="header-anchor">#</a> 验证</h3> <p>运行测试，查看代码是否测试通过。</p> <h2 id="模拟静态方法"><a href="#模拟静态方法" class="header-anchor">#</a> 模拟静态方法</h2> <h3 id="使用-powermock-来模拟静态方法"><a href="#使用-powermock-来模拟静态方法" class="header-anchor">#</a> 使用 Powermock 来模拟静态方法</h3> <p>因为 Mockito 不能够 mock 静态方法，因此我们可以使用 <code>Powermock</code>。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">InetAddress</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">UnknownHostException</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">NetworkReader</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">getLocalHostname</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> hostname <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">InetAddress</span> addr <span class="token operator">=</span> <span class="token class-name">InetAddress</span><span class="token punctuation">.</span><span class="token function">getLocalHost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// Get hostname</span>
            hostname <span class="token operator">=</span> addr<span class="token punctuation">.</span><span class="token function">getHostName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span> <span class="token class-name">UnknownHostException</span> e <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> hostname<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>我们模拟了 NetworkReader 的依赖，如下代码所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runner<span class="token punctuation">.</span></span><span class="token class-name">RunWith</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>powermock<span class="token punctuation">.</span>core<span class="token punctuation">.</span>classloader<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">PrepareForTest</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span> <span class="token class-name">PowerMockRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">)</span>
<span class="token annotation punctuation">@PrepareForTest</span><span class="token punctuation">(</span> <span class="token class-name">NetworkReader</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyTest</span> <span class="token punctuation">{</span>

<span class="token comment">// 测试代码</span>

 <span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">mockStatic</span><span class="token punctuation">(</span> <span class="token class-name">NetworkUtil</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">when</span><span class="token punctuation">(</span> <span class="token class-name">NetworkReader</span><span class="token punctuation">.</span><span class="token function">getLocalHostname</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">andReturn</span><span class="token punctuation">(</span> <span class="token string">&quot;localhost&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 与 NetworkReader 协作的测试</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="用封装的方法代替-powermock"><a href="#用封装的方法代替-powermock" class="header-anchor">#</a> 用封装的方法代替 Powermock</h3> <p>有时候我们可以在静态方法周围包含非静态的方法来达到和 Powermock 同样的效果。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">FooWraper</span> <span class="token punctuation">{</span>
      <span class="token keyword">void</span> <span class="token function">someMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token class-name">Foo</span><span class="token punctuation">.</span><span class="token function">someStaticMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
       <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="引用和引申"><a href="#引用和引申" class="header-anchor">#</a> 引用和引申</h2> <ul><li><a href="https://site.mockito.org/" target="_blank" rel="noopener noreferrer">官网<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/mockito/mockito" target="_blank" rel="noopener noreferrer">Github<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/xitu/gold-miner/blob/master/TODO/Unit-tests-with-Mockito.md" target="_blank" rel="noopener noreferrer">使用强大的 Mockito 测试框架来测试你的代码<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div>  <div class="page-edit"><div class="edit-link"><a href="https://github.com/dunwu/java-tutorial/edit/master/docs/01.Java/12.工具/04.测试/02.Mockito.md" target="_blank" rel="noopener noreferrer">📝 帮助改善此页面！</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="tags"><a href="/java-tutorial/tags/?tag=Java" title="标签">#Java</a><a href="/java-tutorial/tags/?tag=%E6%B5%8B%E8%AF%95" title="标签">#测试</a><a href="/java-tutorial/tags/?tag=Mockito" title="标签">#Mockito</a></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2024/12/31, 08:02:35</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/java-tutorial/pages/b39f47/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">JUnit5 快速入门</div></a> <a href="/java-tutorial/pages/0e5ab1/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">JMeter 快速入门</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/java-tutorial/pages/b39f47/" class="prev">JUnit5 快速入门</a></span> <span class="next"><a href="/java-tutorial/pages/0e5ab1/">JMeter 快速入门</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/java-tutorial/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/java-tutorial/pages/191cdb/"><div>
            Spring Data 综合
            <!----></div></a> <span class="date">02-08</span></dt></dl><dl><dd>02</dd> <dt><a href="/java-tutorial/pages/65e4a2/"><div>
            Spring 访问 Redis
            <!----></div></a> <span class="date">01-31</span></dt></dl><dl><dd>03</dd> <dt><a href="/java-tutorial/pages/1f743f/"><div>
            Spring EL 表达式
            <!----></div></a> <span class="date">01-12</span></dt></dl> <dl><dd></dd> <dt><a href="/java-tutorial/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:forbreak@163.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/dunwu" title="GitHub" target="_blank" class="iconfont icon-github"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2019-2024
    <span>钝悟（dunwu） | CC-BY-SA-4.0</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <div class="custom-html-window custom-html-window-rb" style="display:;"><div class="custom-wrapper"><span class="close-but">×</span> <div>
    <div class="wwads-cn wwads-vertical windowRB" data-id="261" style="max-width:160px;
    min-width: auto;min-height:auto;"></div>
    <style>
      .windowRB{ padding: 0;}
      .windowRB .wwads-img{margin-top: 10px;}
      .windowRB .wwads-content{margin: 0 10px 40px 10px;}
      .custom-html-window-rb .close-but{
        display: none;
      }
    </style>
  </div></div></div></div><div class="global-ui"></div></div>
    <script src="/java-tutorial/assets/js/app.daf69751.js" defer></script><script src="/java-tutorial/assets/js/2.bc9223e0.js" defer></script><script src="/java-tutorial/assets/js/50.b5439840.js" defer></script>
  </body>
</html>
