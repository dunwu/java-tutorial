(window.webpackJsonp=window.webpackJsonp||[]).push([[79],{442:function(t,a,s){"use strict";s.r(a);var n=s(14),e=Object(n.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"spring-数据绑定"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#spring-数据绑定"}},[t._v("#")]),t._v(" Spring 数据绑定")]),t._v(" "),a("p",[a("strong",[t._v("Spring 数据绑定(Data Binding)的作用是将用户的输入动态绑定到 JavaBean")]),t._v("。换句话说，Spring 数据绑定机制是将属性值设置到目标对象中。")]),t._v(" "),a("p",[t._v("在 Spring 中，数据绑定功能主要由 "),a("code",[t._v("DataBinder")]),t._v(" 类实现。此外，"),a("code",[t._v("BeanWrapper")]),t._v(" 也具有类似的功能，但 "),a("code",[t._v("DataBinder")]),t._v(" 额外支持字段验证、字段格式化和绑定结果分析。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/dunwu/images/master/snap/20230111150930.png",alt:""}})]),t._v(" "),a("h2",{attrs:{id:"快速入门"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#快速入门"}},[t._v("#")]),t._v(" 快速入门")]),t._v(" "),a("p",[t._v("定义一个用于测试的 JavaBean")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TestBean")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" num"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getNum")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" num"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setNum")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" num"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("num "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" num"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("toString")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"TestBean{"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"num="')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" num "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token char"}},[t._v("'}'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("数据绑定示例")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DataBindingDemo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MutablePropertyValues")]),t._v(" mpv "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MutablePropertyValues")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        mpv"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"num"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"10"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TestBean")]),t._v(" testBean "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TestBean")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DataBinder")]),t._v(" db "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DataBinder")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("testBean"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        db"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mpv"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("testBean"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h2",{attrs:{id:"spring-数据绑定使用场景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#spring-数据绑定使用场景"}},[t._v("#")]),t._v(" Spring 数据绑定使用场景")]),t._v(" "),a("ul",[a("li",[t._v("Spring "),a("code",[t._v("BeanDefinition")]),t._v(" 到 Bean 实例创建")]),t._v(" "),a("li",[t._v("Spring 数据绑定（"),a("code",[t._v("DataBinder")]),t._v("）")]),t._v(" "),a("li",[t._v("Spring Web 参数绑定（"),a("code",[t._v("WebDataBinder")]),t._v("）")])]),t._v(" "),a("h2",{attrs:{id:"databinder"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#databinder"}},[t._v("#")]),t._v(" DataBinder")]),t._v(" "),a("p",[t._v("在 Spring 中，"),a("code",[t._v("DataBinder")]),t._v(" 类是数据绑定功能的基类。"),a("code",[t._v("WebDataBinder")]),t._v(" 是 "),a("code",[t._v("DataBinder")]),t._v(" 的子类，主要用于 Spring Web 数据绑定，此外，还有一些 "),a("code",[t._v("WebDataBinder")]),t._v(" 的扩展子类，其类族如下图所示：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/dunwu/images/master/snap/20230111152225.png",alt:""}})]),t._v(" "),a("p",[t._v("DataBinder 核心属性：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("属性")]),t._v(" "),a("th",[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("code",[t._v("target")])]),t._v(" "),a("td",[t._v("关联目标 Bean")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("objectName")])]),t._v(" "),a("td",[t._v("目标 Bean 名称")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("bindingResult")])]),t._v(" "),a("td",[t._v("属性绑定结果")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("typeConverter")])]),t._v(" "),a("td",[t._v("类型转换器")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("conversionService")])]),t._v(" "),a("td",[t._v("类型转换服务")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("messageCodesResolver")])]),t._v(" "),a("td",[t._v("校验错误文案 Code 处理器")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("validators")])]),t._v(" "),a("td",[t._v("关联的 Bean Validator 实例集合")])])])]),t._v(" "),a("p",[a("code",[t._v("DataBinder")]),t._v(" 类的核心方法是 "),a("code",[t._v("bind(PropertyValues)")]),t._v("：将 PropertyValues Key-Value 内容映射到关联 Bean（target）中的属性上")]),t._v(" "),a("ul",[a("li",[t._v("假设 PropertyValues 中包含 name=dunwu 的键值对时, 同时 Bean 对象 User 中存在 name 属性, 当 bind 方法执行时, User 对象中的 name 属性值将被绑定为 dunwu")])]),t._v(" "),a("h2",{attrs:{id:"spring-数据绑定元数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#spring-数据绑定元数据"}},[t._v("#")]),t._v(" Spring 数据绑定元数据")]),t._v(" "),a("p",[t._v("DataBinder 元数据 - PropertyValues")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("特征")]),t._v(" "),a("th",[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("数据来源")]),t._v(" "),a("td",[t._v("BeanDefinition，主要来源 XML 资源配置 BeanDefinition")])]),t._v(" "),a("tr",[a("td",[t._v("数据结构")]),t._v(" "),a("td",[t._v("由一个或多个 PropertyValue 组成")])]),t._v(" "),a("tr",[a("td",[t._v("成员结构")]),t._v(" "),a("td",[t._v("PropertyValue 包含属性名称，以及属性值（包括原始值、类型转换后的值）")])]),t._v(" "),a("tr",[a("td",[t._v("常见实现")]),t._v(" "),a("td",[t._v("MutablePropertyValues")])]),t._v(" "),a("tr",[a("td",[t._v("Web 扩展实现")]),t._v(" "),a("td",[t._v("ServletConfigPropertyValues、ServletRequestParameterPropertyValues")])]),t._v(" "),a("tr",[a("td",[t._v("相关生命周期")]),t._v(" "),a("td",[t._v("InstantiationAwareBeanPostProcessor#postProcessProperties")])])])]),t._v(" "),a("h2",{attrs:{id:"spring-数据绑定控制参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#spring-数据绑定控制参数"}},[t._v("#")]),t._v(" Spring 数据绑定控制参数")]),t._v(" "),a("p",[t._v("DataBinder 绑定特殊场景分析")]),t._v(" "),a("ul",[a("li",[t._v("当 PropertyValues 中包含名称 x 的 PropertyValue，目标对象 B 不存在 x 属性，当 bind 方法执\n行时，会发生什么？")]),t._v(" "),a("li",[t._v("当 PropertyValues 中包含名称 x 的 PropertyValue，目标对象 B 中存在 x 属性，当 bind 方法执\n行时，如何避免 B 属性 x 不被绑定？")]),t._v(" "),a("li",[t._v("当 PropertyValues 中包含名称 x.y 的 PropertyValue，目标对象 B 中存在 x 属性（嵌套 y 属性）\n，当 bind 方法执行时，会发生什么？")])]),t._v(" "),a("h3",{attrs:{id:"databinder-绑定控制参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#databinder-绑定控制参数"}},[t._v("#")]),t._v(" DataBinder 绑定控制参数")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("参数名称")]),t._v(" "),a("th",[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("ignoreUnknownFields")]),t._v(" "),a("td",[t._v("是否忽略未知字段，默认值：true")])]),t._v(" "),a("tr",[a("td",[t._v("ignoreInvalidFields")]),t._v(" "),a("td",[t._v("是否忽略非法字段，默认值：false")])]),t._v(" "),a("tr",[a("td",[t._v("autoGrowNestedPaths")]),t._v(" "),a("td",[t._v("是否自动增加嵌套路径，默认值：true")])]),t._v(" "),a("tr",[a("td",[t._v("allowedFields")]),t._v(" "),a("td",[t._v("绑定字段白名单")])]),t._v(" "),a("tr",[a("td",[t._v("disallowedFields")]),t._v(" "),a("td",[t._v("绑定字段黑名单")])]),t._v(" "),a("tr",[a("td",[t._v("requiredFields")]),t._v(" "),a("td",[t._v("必须绑定字段")])])])]),t._v(" "),a("h2",{attrs:{id:"beanwrapper-的使用场景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#beanwrapper-的使用场景"}},[t._v("#")]),t._v(" BeanWrapper 的使用场景")]),t._v(" "),a("ul",[a("li",[t._v("Spring 底层 JavaBeans 基础设施的中心化接口")]),t._v(" "),a("li",[t._v("通常不会直接使用，间接用于 BeanFactory 和 DataBinder")]),t._v(" "),a("li",[t._v("提供标准 JavaBeans 分析和操作，能够单独或批量存储 Java Bean 的属性（properties）")]),t._v(" "),a("li",[t._v("支持嵌套属性路径（nested path）")]),t._v(" "),a("li",[t._v("实现类 org.springframework.beans.BeanWrapperImpl")])]),t._v(" "),a("h2",{attrs:{id:"spring-底层-java-beans-替换实现"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#spring-底层-java-beans-替换实现"}},[t._v("#")]),t._v(" Spring 底层 Java Beans 替换实现")]),t._v(" "),a("p",[t._v("JavaBeans 核心实现 - "),a("code",[t._v("java.beans.BeanInfo")])]),t._v(" "),a("ul",[a("li",[t._v("属性（Property）\n"),a("ul",[a("li",[a("code",[t._v("java.beans.PropertyEditor")])])])]),t._v(" "),a("li",[t._v("方法（Method）")]),t._v(" "),a("li",[t._v("事件（Event）")]),t._v(" "),a("li",[t._v("表达式（Expression）")])]),t._v(" "),a("p",[t._v("Spring 替代实现 - "),a("code",[t._v("org.springframework.beans.BeanWrapper")])]),t._v(" "),a("ul",[a("li",[t._v("属性（Property）\n"),a("ul",[a("li",[a("code",[t._v("java.beans.PropertyEditor")])])])]),t._v(" "),a("li",[t._v("嵌套属性路径（nested path）")])]),t._v(" "),a("h2",{attrs:{id:"databinder-数据校验"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#databinder-数据校验"}},[t._v("#")]),t._v(" DataBinder 数据校验")]),t._v(" "),a("p",[t._v("DataBinder 与 BeanWrapper")]),t._v(" "),a("ul",[a("li",[t._v("bind 方法生成 BeanPropertyBindingResult")]),t._v(" "),a("li",[t._v("BeanPropertyBindingResult 关联 BeanWrapper")])]),t._v(" "),a("h2",{attrs:{id:"问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#问题"}},[t._v("#")]),t._v(" 问题")]),t._v(" "),a("p",[t._v("标准 JavaBeans 是如何操作属性的？")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("API")]),t._v(" "),a("th",[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("java.beans.Introspector")]),t._v(" "),a("td",[t._v("Java Beans 内省 API")])]),t._v(" "),a("tr",[a("td",[t._v("java.beans.BeanInfo")]),t._v(" "),a("td",[t._v("Java Bean 元信息 API")])]),t._v(" "),a("tr",[a("td",[t._v("java.beans.BeanDescriptor")]),t._v(" "),a("td",[t._v("Java Bean 信息描述符")])]),t._v(" "),a("tr",[a("td",[t._v("java.beans.PropertyDescriptor")]),t._v(" "),a("td",[t._v("Java Bean 属性描述符")])]),t._v(" "),a("tr",[a("td",[t._v("java.beans.MethodDescriptor")]),t._v(" "),a("td",[t._v("Java Bean 方法描述符")])]),t._v(" "),a("tr",[a("td",[t._v("java.beans.EventSetDescriptor")]),t._v(" "),a("td",[t._v("Java Bean 事件集合描述符")])])])]),t._v(" "),a("h2",{attrs:{id:"参考资料"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[t._v("#")]),t._v(" 参考资料")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#beans",target:"_blank",rel:"noopener noreferrer"}},[t._v("Spring 官方文档之 Core Technologies"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://time.geekbang.org/course/intro/265",target:"_blank",rel:"noopener noreferrer"}},[t._v("《小马哥讲 Spring 核心编程思想》"),a("OutboundLink")],1)])])])}),[],!1,null,null,null);a.default=e.exports}}]);