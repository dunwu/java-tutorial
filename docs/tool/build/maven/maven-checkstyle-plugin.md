# Maven æ’ä»¶ä¹‹ä»£ç æ£€æŸ¥

> **ğŸ“¦ æœ¬æ–‡å·²å½’æ¡£åœ¨ [java-tutorial](https://dunwu.github.io/java-tutorial/#/)**
>
<!-- TOC depthFrom:2 depthTo:3 -->

- [maven-checkstyle-plugin](#maven-checkstyle-plugin)
  - [å®šä¹‰ checkstyle.xml](#å®šä¹‰-checkstylexml)
- [maven-pmd-plugin](#maven-pmd-plugin)
- [å‚è€ƒèµ„æ–™](#å‚è€ƒèµ„æ–™)

<!-- /TOC -->

## maven-checkstyle-plugin

> **maven-checkstyle-pluginï¼Œç”¨äºæ£€æµ‹ä»£ç ä¸­ä¸ç¬¦åˆè§„èŒƒçš„åœ°æ–¹ã€‚**

### å®šä¹‰ checkstyle.xml

```xml
<!DOCTYPE module PUBLIC
  "-//Checkstyle//DTD Checkstyle Configuration 1.3//EN"
  "https://checkstyle.org/dtds/configuration_1_3.dtd">

<!-- Generated by RHY @will_awoke -->

<module name="Checker">

  <property name="charset" value="UTF-8"/>
  <property name="severity" value="warning"/>

  <!-- Checks for Size Violations.  -->
  <!-- æ£€æŸ¥æ–‡ä»¶çš„é•¿åº¦ï¼ˆè¡Œï¼‰ default max=2000 -->
  <module name="FileLength">
    <property name="max" value="2500"/>
  </module>

  <!-- Checks that property files contain the same keys. -->
  <!-- æ£€æŸ¥**.propertiesé…ç½®æ–‡ä»¶ æ˜¯å¦æœ‰ç›¸åŒçš„key
  <module name="Translation">
  </module>
  -->

  <module name="TreeWalker">

    <!-- Checks for imports    -->
    <!-- å¿…é¡»å¯¼å…¥ç±»çš„å®Œæ•´è·¯å¾„ï¼Œå³ä¸èƒ½ä½¿ç”¨*å¯¼å…¥æ‰€éœ€çš„ç±» -->
    <module name="AvoidStarImport"/>

    <!-- æ£€æŸ¥æ˜¯å¦ä»éæ³•çš„åŒ…ä¸­å¯¼å…¥äº†ç±» illegalPkgs: å®šä¹‰éæ³•çš„åŒ…åç§°-->
    <module name="IllegalImport"/> <!-- defaults to sun.* packages -->

    <!-- æ£€æŸ¥æ˜¯å¦å¯¼å…¥äº†ä¸å¿…æ˜¾ç¤ºå¯¼å…¥çš„ç±»-->
    <module name="RedundantImport"/>

    <!-- æ£€æŸ¥æ˜¯å¦å¯¼å…¥çš„åŒ…æ²¡æœ‰ä½¿ç”¨-->
    <module name="UnusedImports"/>

    <!-- Checks for whitespace
    <module name="EmptyForIteratorPad"/>
    <module name="MethodParamPad"/>
    <module name="NoWhitespaceAfter"/>
    <module name="NoWhitespaceBefore"/>
    <module name="OperatorWrap"/>
    <module name="ParenPad"/>
    <module name="TypecastParenPad"/>
    <module name="WhitespaceAfter"/>
    <module name="WhitespaceAround"/>
    -->

    <!-- æ£€æŸ¥ç±»å’Œæ¥å£çš„javadoc é»˜è®¤ä¸æ£€æŸ¥author å’Œversion tags
      authorFormat: æ£€æŸ¥authoræ ‡ç­¾çš„æ ¼å¼
            versionFormat: æ£€æŸ¥versionæ ‡ç­¾çš„æ ¼å¼
            scope: å¯ä»¥æ£€æŸ¥çš„ç±»çš„èŒƒå›´ï¼Œä¾‹å¦‚ï¼špublicåªèƒ½æ£€æŸ¥publicä¿®é¥°çš„ç±»ï¼Œprivateå¯ä»¥æ£€æŸ¥æ‰€æœ‰çš„ç±»
            excludeScope: ä¸èƒ½æ£€æŸ¥çš„ç±»çš„èŒƒå›´ï¼Œä¾‹å¦‚ï¼špublicï¼Œpublicçš„ç±»å°†ä¸è¢«æ£€æŸ¥ï¼Œä½†è®¿é—®æƒé™å°äºpublicçš„ç±»ä»ç„¶ä¼šæ£€æŸ¥ï¼Œå…¶ä»–çš„æƒé™ä»¥æ­¤ç±»æ¨
            tokens: è¯¥å±æ€§é€‚ç”¨çš„ç±»å‹ï¼Œä¾‹å¦‚ï¼šCLASS_DEF,INTERFACE_DEF -->
    <module name="JavadocType">
      <property name="authorFormat" value="\S"/>
      <property name="scope" value="protected"/>
      <property name="tokens" value="CLASS_DEF,INTERFACE_DEF"/>
    </module>

    <!-- æ£€æŸ¥æ–¹æ³•çš„javadocçš„æ³¨é‡Š
            scope: å¯ä»¥æ£€æŸ¥çš„æ–¹æ³•çš„èŒƒå›´ï¼Œä¾‹å¦‚ï¼špublicåªèƒ½æ£€æŸ¥publicä¿®é¥°çš„æ–¹æ³•ï¼Œprivateå¯ä»¥æ£€æŸ¥æ‰€æœ‰çš„æ–¹æ³•
            allowMissingParamTags: æ˜¯å¦å¿½ç•¥å¯¹å‚æ•°æ³¨é‡Šçš„æ£€æŸ¥
            allowMissingThrowsTags: æ˜¯å¦å¿½ç•¥å¯¹throwsæ³¨é‡Šçš„æ£€æŸ¥
            allowMissingReturnTag: æ˜¯å¦å¿½ç•¥å¯¹returnæ³¨é‡Šçš„æ£€æŸ¥ -->
    <module name="JavadocMethod">
      <property name="scope" value="private"/>
      <property name="allowMissingParamTags" value="false"/>
      <property name="allowMissingThrowsTags" value="false"/>
      <property name="allowMissingReturnTag" value="false"/>
      <property name="tokens" value="METHOD_DEF"/>
      <property name="allowUndeclaredRTE" value="true"/>
      <property name="allowThrowsTagsForSubclasses" value="true"/>
      <!--å…è®¸get set æ–¹æ³•æ²¡æœ‰æ³¨é‡Š-->
      <property name="allowMissingPropertyJavadoc" value="true"/>
    </module>

    <!-- æ£€æŸ¥ç±»å˜é‡çš„æ³¨é‡Š
            scope: æ£€æŸ¥å˜é‡çš„èŒƒå›´ï¼Œä¾‹å¦‚ï¼špublicåªèƒ½æ£€æŸ¥publicä¿®é¥°çš„å˜é‡ï¼Œprivateå¯ä»¥æ£€æŸ¥æ‰€æœ‰çš„å˜é‡ -->
    <module name="JavadocVariable">
      <property name="scope" value="private"/>
    </module>

    <!--option: å®šä¹‰å·¦å¤§æ‹¬å·'{'æ˜¾ç¤ºä½ç½®ï¼Œeolåœ¨åŒä¸€è¡Œæ˜¾ç¤ºï¼Œnlåœ¨ä¸‹ä¸€è¡Œæ˜¾ç¤º
      maxLineLength: å¤§æ‹¬å·'{'æ‰€åœ¨è¡Œè¡Œæœ€å¤šå®¹çº³çš„å­—ç¬¦æ•°
      tokens: è¯¥å±æ€§é€‚ç”¨çš„ç±»å‹ï¼Œä¾‹ï¼šCLASS_DEF,INTERFACE_DEF,METHOD_DEF,CTOR_DEF -->
    <module name="LeftCurly">
      <property name="option" value="nl"/>
    </module>

    <!-- NeedBraces æ£€æŸ¥æ˜¯å¦åº”è¯¥ä½¿ç”¨æ‹¬å·çš„åœ°æ–¹æ²¡æœ‰åŠ æ‹¬å·
      tokens: å®šä¹‰æ£€æŸ¥çš„ç±»å‹ -->
    <module name="NeedBraces"/>

    <!-- Checks the placement of right curly braces ('}') for  else, try, and catch tokens. The policy to verify is specified using property  option.
      option: å³å¤§æ‹¬å·æ˜¯å¦å•ç‹¬ä¸€è¡Œæ˜¾ç¤º
      tokens: å®šä¹‰æ£€æŸ¥çš„ç±»å‹  -->
    <module name="RightCurly">
      <property name="option" value="alone"/>
    </module>

    <!-- æ£€æŸ¥åœ¨é‡å†™äº†equalsæ–¹æ³•åæ˜¯å¦é‡å†™äº†hashCodeæ–¹æ³• -->
    <module name="EqualsHashCode"/>

    <!--  Checks for illegal instantiations where a factory method is preferred.
      Rationale: Depending on the project, for some classes it might be preferable to create instances through factory methods rather than calling the constructor.
      A simple example is the java.lang.Boolean class. In order to save memory and CPU cycles, it is preferable to use the predefined constants TRUE and FALSE. Constructor invocations should be replaced by calls to Boolean.valueOf().
      Some extremely performance sensitive projects may require the use of factory methods for other classes as well, to enforce the usage of number caches or object pools. -->
    <module name="IllegalInstantiation">
      <property name="classes" value="java.lang.Boolean"/>
    </module>

    <!-- Checks for Naming Conventions.   å‘½åè§„èŒƒ   -->
    <!-- local, final variables, including catch parameters -->
    <module name="LocalFinalVariableName"/>

    <!-- local, non-final variables, including catch parameters-->
    <module name="LocalVariableName"/>

    <!-- static, non-final fields -->
    <module name="StaticVariableName">
      <property name="format" value="(^[A-Z0-9_]{0,19}$)"/>
    </module>

    <!-- packages -->
    <module name="PackageName">
      <property name="format" value="^[a-z]+(\.[a-z][a-z0-9]*)*$"/>
    </module>

    <!-- classes and interfaces -->
    <module name="TypeName">
      <property name="format" value="(^[A-Z][a-zA-Z0-9]{0,19}$)"/>
    </module>

    <!-- methods -->
    <module name="MethodName">
      <property name="format" value="(^[a-z][a-zA-Z0-9]{0,19}$)"/>
    </module>

    <!-- non-static fields -->
    <module name="MemberName">
      <property name="format" value="(^[a-z][a-z0-9][a-zA-Z0-9]{0,19}$)"/>
    </module>

    <!-- parameters -->
    <module name="ParameterName">
      <property name="format" value="(^[a-z][a-zA-Z0-9_]{0,19}$)"/>
    </module>

    <!-- constants (static,  final fields) -->
    <module name="ConstantName">
      <property name="format" value="(^[A-Z0-9_]{0,19}$)"/>
    </module>

    <!-- ä»£ç ç¼©è¿›   -->
    <module name="Indentation">
    </module>

    <!-- Checks for redundant exceptions declared in throws clause such as duplicates, unchecked exceptions or subclasses of another declared exception.
      æ£€æŸ¥æ˜¯å¦æŠ›å‡ºäº†å¤šä½™çš„å¼‚å¸¸
    <module name="RedundantThrows">
        <property name="logLoadErrors" value="true"/>
        <property name="suppressLoadErrors" value="true"/>
    </module>
    -->

    <!--  Checks for overly complicated boolean expressions. Currently finds code like  if (b == true), b || true, !false, etc.
      æ£€æŸ¥booleanå€¼æ˜¯å¦å†—ä½™çš„åœ°æ–¹
      Rationale: Complex boolean logic makes code hard to understand and maintain. -->
    <module name="SimplifyBooleanExpression"/>

    <!--  Checks for overly complicated boolean return statements. For example the following code
       æ£€æŸ¥æ˜¯å¦å­˜åœ¨è¿‡åº¦å¤æ‚çš„booleanè¿”å›å€¼
       if (valid())
          return false;
       else
          return true;
       could be written as
          return !valid();
       The Idea for this Check has been shamelessly stolen from the equivalent PMD rule. -->
    <module name="SimplifyBooleanReturn"/>

    <!-- Checks that a class which has only private constructors is declared as final.åªæœ‰ç§æœ‰æ„é€ å™¨çš„ç±»å¿…é¡»å£°æ˜ä¸ºfinal-->
    <module name="FinalClass"/>

    <!--  Make sure that utility classes (classes that contain only static methods or fields in their API) do not have a public constructor.
      ç¡®ä¿Utilsç±»ï¼ˆåªæä¾›staticæ–¹æ³•å’Œå±æ€§çš„ç±»ï¼‰æ²¡æœ‰publicæ„é€ å™¨ã€‚
      Rationale: Instantiating utility classes does not make sense. Hence the constructors should either be private or (if you want to allow subclassing) protected. A common mistake is forgetting to hide the default constructor.
      If you make the constructor protected you may want to consider the following constructor implementation technique to disallow instantiating subclasses:
      public class StringUtils // not final to allow subclassing
      {
          protected StringUtils() {
              throw new UnsupportedOperationException(); // prevents calls from subclass
          }
          public static int count(char c, String s) {
              // ...
          }
      }
   <module name="HideUtilityClassConstructor"/>
   -->

    <!--  Checks visibility of class members. Only static final members may be public; other class members must be private unless property protectedAllowed or packageAllowed is set.
      æ£€æŸ¥classæˆå‘˜å±æ€§å¯è§æ€§ã€‚åªæœ‰static final ä¿®é¥°çš„æˆå‘˜æ˜¯å¯ä»¥publicçš„ã€‚å…¶ä»–çš„æˆå‘˜å±æ€§å¿…éœ€æ˜¯privateçš„ï¼Œé™¤éå±æ€§protectedAllowedæˆ–è€…packageAllowedè®¾ç½®äº†true.
       Public members are not flagged if the name matches the public member regular expression (contains "^serialVersionUID$" by default). Note: Checkstyle 2 used to include "^f[A-Z][a-zA-Z0-9]*$" in the default pattern to allow CMP for EJB 1.1 with the default settings. With EJB 2.0 it is not longer necessary to have public access for persistent fields, hence the default has been changed.
       Rationale: Enforce encapsulation. å¼ºåˆ¶å°è£… -->
    <module name="VisibilityModifier"/>

    <!-- æ¯ä¸€è¡Œåªèƒ½å®šä¹‰ä¸€ä¸ªå˜é‡ -->
    <module name="MultipleVariableDeclarations">
    </module>

    <!-- Checks the style of array type definitions. Some like Java-style: public static void main(String[] args) and some like C-style: public static void main(String args[])
      æ£€æŸ¥å†å®šä¹‰æ•°ç»„æ—¶ï¼Œé‡‡ç”¨javaé£æ ¼è¿˜æ˜¯cé£æ ¼ï¼Œä¾‹å¦‚ï¼šint[] numæ˜¯javaé£æ ¼ï¼Œint num[]æ˜¯cé£æ ¼ã€‚é»˜è®¤æ˜¯javaé£æ ¼-->
    <module name="ArrayTypeStyle">
    </module>

    <!-- Checks that there are no "magic numbers", where a magic number is a numeric literal that is not defined as a constant. By default, -1, 0, 1, and 2 are not considered to be magic numbers.
    <module name="MagicNumber">
    </module>
    -->

    <!-- A check for TODO: comments. Actually it is a generic regular expression matcher on Java comments. To check for other patterns in Java comments, set property format.
       æ£€æŸ¥æ˜¯å¦å­˜åœ¨TODOï¼ˆå¾…å¤„ç†ï¼‰ TODOæ˜¯javaIDEè‡ªåŠ¨ç”Ÿæˆçš„ã€‚ä¸€èˆ¬ä»£ç å†™å®Œåè¦å»æ‰ã€‚
     -->
    <module name="TodoComment"/>

    <!--  Checks that long constants are defined with an upper ell. That is ' L' and not 'l'. This is in accordance to the Java Language Specification,  Section 3.10.1.
      æ£€æŸ¥æ˜¯å¦åœ¨longç±»å‹æ˜¯å¦å®šä¹‰äº†å¤§å†™çš„L.å­—æ¯å°å†™lå’Œæ•°å­—1ï¼ˆä¸€ï¼‰å¾ˆç›¸ä¼¼ã€‚
      looks a lot like 1. -->
    <module name="UpperEll"/>

    <!--  Checks that switch statement has "default" clause. æ£€æŸ¥switchè¯­å¥æ˜¯å¦æœ‰â€˜defaultâ€™ä»å¥
       Rationale: It's usually a good idea to introduce a default case in every switch statement.
       Even if the developer is sure that all currently possible cases are covered, this should be expressed in the default branch,
        e.g. by using an assertion. This way the code is protected aginst later changes, e.g. introduction of new types in an enumeration type. -->
    <module name="MissingSwitchDefault"/>

    <!--æ£€æŸ¥switchä¸­caseåæ˜¯å¦åŠ å…¥äº†è·³å‡ºè¯­å¥ï¼Œä¾‹å¦‚ï¼šreturnã€breakã€throwã€continue -->
    <module name="FallThrough"/>

    <!-- Checks the number of parameters of a method or constructor. max default 7ä¸ª. -->
    <module name="ParameterNumber">
      <property name="max" value="5"/>
    </module>

    <!-- æ¯è¡Œå­—ç¬¦æ•° -->
    <module name="LineLength">
      <property name="max" value="200"/>
    </module>

    <!-- Checks for long methods and constructors. max default 150è¡Œ. max=300 è®¾ç½®é•¿åº¦300 -->
    <module name="MethodLength">
      <property name="max" value="300"/>
    </module>

    <!-- ModifierOrder æ£€æŸ¥ä¿®é¥°ç¬¦çš„é¡ºåºï¼Œé»˜è®¤æ˜¯ public,protected,private,abstract,static,final,transient,volatile,synchronized,native -->
    <module name="ModifierOrder">
    </module>

    <!-- æ£€æŸ¥æ˜¯å¦æœ‰å¤šä½™çš„ä¿®é¥°ç¬¦ï¼Œä¾‹å¦‚ï¼šæ¥å£ä¸­çš„æ–¹æ³•ä¸å¿…ä½¿ç”¨publicã€abstractä¿®é¥°  -->
    <module name="RedundantModifier">
    </module>

    <!--- å­—ç¬¦ä¸²æ¯”è¾ƒå¿…é¡»ä½¿ç”¨ equals() -->
    <module name="StringLiteralEquality">
    </module>

    <!-- if-elseåµŒå¥—è¯­å¥ä¸ªæ•° æœ€å¤š4å±‚ -->
    <module name="NestedIfDepth">
      <property name="max" value="3"/>
    </module>

    <!-- try-catch åµŒå¥—è¯­å¥ä¸ªæ•° æœ€å¤š2å±‚ -->
    <module name="NestedTryDepth">
      <property name="max" value="2"/>
    </module>

    <!-- è¿”å›ä¸ªæ•° -->
    <module name="ReturnCount">
      <property name="max" value="5"/>
      <property name="format" value="^$"/>
    </module>

  </module>
</module>
```

é…ç½® `pom.xml`ï¼š

```xml

<project>
    ...
    <properties>
        <checkstyle.config.location>config/maven_checks.xml</checkstyle.config.location>
    </properties>
    ...
    <reporting>
        <plugins>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-checkstyle-plugin</artifactId>
                <version>3.0</version>
                <executions>
                    <execution>
                        <!-- ç»‘å®špmd:pmdåˆ°validateç”Ÿå‘½å‘¨æœŸï¼Œåœ¨validateæ—¶ä¼šè‡ªåŠ¨è¿›è¡Œä»£ç è§„èŒƒæ£€æŸ¥ -->
                        <id>validate</id>
                        <phase>validate</phase>
                        <configuration>
                            <!-- é…ç½®æ–‡ä»¶çš„è·¯å¾„ï¼Œåœ¨styleæ–‡ä»¶å¤¹ä¸‹ -->
                            <configLocation>style/checkstyle.xml</configLocation>
                            <encoding>UTF-8</encoding>
                            <consoleOutput>true</consoleOutput>
                            <failsOnError>true</failsOnError>
                            <includeTestSourceDirectory>false</includeTestSourceDirectory>
                        </configuration>
                        <goals>
                            <goal>check</goal>
                        </goals>
                    </execution>
                </executions>
            </plugin>

            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-jxr-plugin</artifactId>
                <version>2.3</version>
            </plugin>
        </plugins>
    </reporting>
    ...
</project>
```

å…¶ä¸­å¯ä»¥ä¿®æ”¹ä½¿ç”¨çš„æ£€æŸ¥è§„åˆ™æ–‡ä»¶è·¯å¾„ï¼Œæ’ä»¶é»˜è®¤æä¾›äº†å››ä¸ªè§„åˆ™æ–‡ä»¶å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œæ— éœ€æ‰‹åŠ¨ä¸‹è½½ï¼š

- config/sun_checks.xml - Sun Microsystems Definition (default).
- config/maven_checks.xml - Maven Development Definitions.
- config/turbine_checks.xml - Turbine Development Definitions.
- config/avalon_checks.xml - Avalon Development Definitions.

é…ç½®å¥½åï¼Œå¯ä»¥æ‰§è¡Œ `mvn clean checkstyle:check` æ£€æŸ¥ä»£ç ã€‚

## maven-pmd-plugin

> maven-pmd-plugin æ˜¯é˜¿é‡Œç¼–ç¨‹è§„èŒƒæ£€æŸ¥æ’ä»¶ã€‚

é…ç½® `pom.xml`ï¼š

å‚è€ƒ https://github.com/alibaba/p3c/blob/master/p3c-pmd/pom.xml é…ç½®

```xml
      <plugin>
        <groupId>org.apache.maven.plugins</groupId>
        <artifactId>maven-pmd-plugin</artifactId>
        <version>3.11.0</version>
        <configuration>
          <sourceEncoding>${project.build.sourceEncoding}</sourceEncoding>
          <targetJdk>${maven.compiler.target}</targetJdk>
          <printFailingErrors>true</printFailingErrors>
          <rulesets>
            <ruleset>rulesets/java/ali-comment.xml</ruleset>
            <ruleset>rulesets/java/ali-concurrent.xml</ruleset>
            <ruleset>rulesets/java/ali-constant.xml</ruleset>
            <ruleset>rulesets/java/ali-exception.xml</ruleset>
            <ruleset>rulesets/java/ali-flowcontrol.xml</ruleset>
            <ruleset>rulesets/java/ali-naming.xml</ruleset>
            <ruleset>rulesets/java/ali-oop.xml</ruleset>
            <ruleset>rulesets/java/ali-orm.xml</ruleset>
            <ruleset>rulesets/java/ali-other.xml</ruleset>
            <ruleset>rulesets/java/ali-set.xml</ruleset>
          </rulesets>
          <printFailingErrors>true</printFailingErrors>
        </configuration>
        <executions>
          <execution>
            <phase>verify</phase>
            <goals>
              <goal>check</goal>
            </goals>
          </execution>
        </executions>
        <dependencies>
          <dependency>
            <groupId>com.alibaba.p3c</groupId>
            <artifactId>p3c-pmd</artifactId>
            <version>2.0.0</version>
          </dependency>
        </dependencies>
      </plugin>
    </plugins>
```

é…ç½®å¥½åï¼Œå¯ä»¥æ‰§è¡Œ `mvn clean pmd:check` æ£€æŸ¥ä»£ç ã€‚

## å‚è€ƒèµ„æ–™

- https://maven.apache.org/plugins/maven-checkstyle-plugin/
- https://maven.apache.org/jxr/maven-jxr-plugin/
- https://www.jianshu.com/p/557b975ae40d
- é˜¿é‡Œå·´å·´ç¼–ç¨‹è§„èŒƒ
  - https://github.com/alibaba/p3c
  - https://github.com/alibaba/p3c/blob/master/p3c-pmd/pom.xml
