# JMeter åº”ç”¨æŒ‡å—

> [Jmeter](https://github.com/apache/jmeter) æ˜¯ä¸€æ¬¾åŸºäº Java å¼€å‘çš„åŠŸèƒ½å’Œæ€§èƒ½æµ‹è¯•è½¯ä»¶ã€‚
>
> ğŸ æœ¬æ–‡ç¼–è¾‘æ—¶çš„æœ€æ–°ç‰ˆæœ¬ä¸ºï¼š5.1.1

## 1. ç®€ä»‹

[Jmeter](https://github.com/apache/jmeter) æ˜¯ä¸€æ¬¾ä½¿ç”¨ Java å¼€å‘çš„åŠŸèƒ½å’Œæ€§èƒ½æµ‹è¯•è½¯ä»¶ã€‚

### 1.1. ç‰¹æ€§

Jmeter èƒ½å¤ŸåŠ è½½å’Œæ€§èƒ½æµ‹è¯•è®¸å¤šä¸åŒçš„åº”ç”¨ç¨‹åº/æœåŠ¡å™¨/åè®®ç±»å‹ï¼š

- ç½‘ç»œ - HTTPï¼ŒHTTPS(Javaï¼ŒNodeJSï¼ŒPHPï¼ŒASP.NET ç­‰)
- SOAP / REST Web æœåŠ¡
- FTP æ–‡ä»¶
- é€šè¿‡ JDBC çš„æ•°æ®åº“
- LDAP
- é€šè¿‡ JMS çš„é¢å‘æ¶ˆæ¯çš„ä¸­é—´ä»¶(MOM)
- é‚®ä»¶-SMTP(S)ï¼ŒPOP3(S)å’Œ IMAP(S)
- æœ¬æœºå‘½ä»¤æˆ– Shell è„šæœ¬
- TCP åè®®
- Java å¯¹è±¡

### 1.2. å·¥ä½œæµ

Jmeter çš„å·¥ä½œåŸç†æ˜¯ä»¿çœŸç”¨æˆ·å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œå¹¶æ”¶é›†æœåŠ¡å™¨åº”ç­”ä¿¡æ¯å¹¶è®¡ç®—ç»Ÿè®¡ä¿¡æ¯ã€‚

Jmeter çš„å·¥ä½œæµå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![](http://dunwu.test.upcdn.net/cs/java/javaweb/technology/test/jmeter-workflow.png!zp)

### 1.3. ä¸»è¦å…ƒç´ 

Jmeter çš„ä¸»è¦å…ƒç´ å¦‚ä¸‹ï¼š

- **`æµ‹è¯•è®¡åˆ’(Test Plan)`** - å¯ä»¥å°†æµ‹è¯•è®¡åˆ’è§†ä¸º JMeter çš„æµ‹è¯•è„šæœ¬ ã€‚æµ‹è¯•è®¡åˆ’ç”±æµ‹è¯•å…ƒç´ ç»„æˆï¼Œä¾‹å¦‚çº¿ç¨‹ç»„ï¼Œé€»è¾‘æ§åˆ¶å™¨ï¼Œæ ·æœ¬ç”Ÿæˆæ§åˆ¶å™¨ï¼Œç›‘å¬å™¨ï¼Œå®šæ—¶å™¨ï¼Œæ–­è¨€å’Œé…ç½®å…ƒç´ ã€‚
- **`çº¿ç¨‹ç»„(Thread Group)`** - çº¿ç¨‹ç»„çš„ä½œç”¨æ˜¯ï¼šæ¨¡æ‹Ÿå¤§é‡ç”¨æˆ·è´Ÿè½½çš„è¿è¡Œåœºæ™¯ã€‚
  - è®¾ç½®çº¿ç¨‹æ•°
  - è®¾ç½®åŠ é€ŸæœŸ
  - è®¾ç½®æ‰§è¡Œæµ‹è¯•çš„æ¬¡æ•°
- **`æ§åˆ¶å™¨(Controllers)`** - å¯ä»¥åˆ†ä¸ºä¸¤å¤§ç±»ï¼š
  - **`é‡‡æ ·å™¨ï¼ˆSamplerï¼‰`** - é‡‡æ ·å™¨çš„ä½œç”¨æ˜¯æ¨¡æ‹Ÿç”¨æˆ·å¯¹ç›®æ ‡æœåŠ¡å™¨å‘é€è¯·æ±‚ã€‚ é‡‡æ ·å™¨æ˜¯å¿…é¡»å°†ç»„ä»¶æ·»åŠ åˆ°æµ‹è¯•è®¡åˆ’ä¸­çš„ï¼Œå› ä¸ºå®ƒåªèƒ½è®© JMeter çŸ¥é“éœ€è¦å°†å“ªç§ç±»å‹çš„è¯·æ±‚å‘é€åˆ°æœåŠ¡å™¨ã€‚ è¯·æ±‚å¯ä»¥æ˜¯ HTTPï¼ŒHTTP(s)ï¼ŒFTPï¼ŒTCPï¼ŒSMTPï¼ŒSOAP ç­‰ã€‚
  - **`é€»è¾‘æ§åˆ¶å™¨`** - é€»è¾‘æ§åˆ¶å™¨çš„ä½œç”¨æ˜¯ï¼šæ§åˆ¶å¤šä¸ªè¯·æ±‚å‘é€çš„å¾ªç¯æ¬¡æ•°åŠé¡ºåºç­‰ã€‚
- **`ç›‘å¬å™¨(Listeners)`** - ç›‘å¬å™¨çš„ä½œç”¨æ˜¯ï¼šæ”¶é›†æµ‹è¯•ç»“æœä¿¡æ¯ã€‚å¦‚æŸ¥çœ‹ç»“æœæ ‘ã€æ±‡æ€»æŠ¥å‘Šç­‰ã€‚
- **`è®¡æ—¶å™¨(Timers)`** - è®¡æ—¶å™¨çš„ä½œç”¨æ˜¯ï¼šæ§åˆ¶å¤šä¸ªè¯·æ±‚å‘é€çš„æ—¶é—´é¢‘æ¬¡ã€‚
- **`é…ç½®å…ƒç´ (Configuration Elements)`** - é…ç½®å…ƒç´ çš„å·¥ä½œä¸é‡‡æ ·å™¨çš„å·¥ä½œç±»ä¼¼ã€‚ä½†æ˜¯ï¼Œå®ƒä¸å‘é€è¯·æ±‚ï¼Œè€Œæ˜¯æä¾›é¢„å¤‡çš„æ•°æ®ç­‰ï¼Œå¦‚ CSVã€å‡½æ•°åŠ©æ‰‹ã€‚
- **`é¢„å¤„ç†å™¨å…ƒç´ (Pre-Processor Elements)`** - é¢„å¤„ç†å™¨å…ƒç´ åœ¨é‡‡æ ·å™¨å‘å‡ºè¯·æ±‚ä¹‹å‰æ‰§è¡Œï¼Œå¦‚æœé¢„å¤„ç†å™¨é™„åŠ åˆ°é‡‡æ ·å™¨å…ƒç´ ï¼Œé‚£ä¹ˆå®ƒå°†åœ¨è¯¥é‡‡æ ·å™¨å…ƒç´ è¿è¡Œä¹‹å‰æ‰§è¡Œã€‚é¢„å¤„ç†å™¨å…ƒç´ ç”¨äºåœ¨è¿è¡Œä¹‹å‰å‡†å¤‡ç¯å¢ƒåŠå‚æ•°ã€‚
- **`åå¤„ç†å™¨å…ƒç´ (Post-Processor Elements)`** - åå¤„ç†å™¨å…ƒç´ æ˜¯åœ¨å‘é€é‡‡æ ·å™¨è¯·æ±‚ä¹‹åæ‰§è¡Œçš„å…ƒç´ ï¼Œå¸¸ç”¨äºå¤„ç†å“åº”æ•°æ®ã€‚

![](http://dunwu.test.upcdn.net/cs/java/javaweb/technology/test/jmeter-elements.png!zp)

> ğŸ“Œ æç¤ºï¼š
>
> Jmeter å…ƒç´ çš„æ•°é‡å…³ç³»å¤§è‡´å¦‚ä¸‹ï¼š
>
> 1. è„šæœ¬ä¸­æœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªæµ‹è¯•è®¡åˆ’ã€‚
> 2. æµ‹è¯•è®¡åˆ’ä¸­è‡³å°‘è¦æœ‰ä¸€ä¸ªçº¿ç¨‹ç»„ã€‚
> 3. çº¿ç¨‹ç»„ä¸­è‡³å°‘è¦æœ‰ä¸€ä¸ªå–æ ·å™¨ã€‚
> 4. çº¿ç¨‹ç»„ä¸­è‡³å°‘è¦æœ‰ä¸€ä¸ªç›‘å¬å™¨ã€‚

## 2. å®‰è£…

### 2.1. ç¯å¢ƒè¦æ±‚

- å¿…è¦çš„ã€‚Jmeter åŸºäº JDK8 å¼€å‘ï¼Œæ‰€ä»¥å¿…é¡»è¿è¡Œåœ¨ JDK8 ç¯å¢ƒã€‚

  - JDK8

- å¯é€‰çš„ã€‚æœ‰äº› jar åŒ…ä¸æ˜¯ Jmeter æä¾›çš„ï¼Œå¦‚æœéœ€è¦ç›¸åº”çš„åŠŸèƒ½ï¼Œéœ€è¦è‡ªè¡Œä¸‹è½½å¹¶ç½®äº `lib` ç›®å½•ã€‚
  - JDBC
  - JMS
  - [Bouncy Castle](http://www.bouncycastle.org/test_releases.html)

### 2.2. ä¸‹è½½

è¿›å…¥ [**Jmeter å®˜ç½‘ä¸‹è½½åœ°å€**](https://jmeter.apache.org/download_jmeter.cgi) é€‰æ‹©éœ€è¦ç‰ˆæœ¬è¿›è¡Œä¸‹è½½ã€‚

### 2.3. å¯åŠ¨

è§£å‹ Jmeter å‹ç¼©åŒ…ï¼Œè¿›å…¥ bin ç›®å½•

Unix ç±»ç³»ç»Ÿè¿è¡Œ `jmeter` ï¼›Windows ç³»ç»Ÿè¿è¡Œ `jmeter.bat`

![image-20191024104517721](http://dunwu.test.upcdn.net/snap/jmeter/image-20191024104517721.png!zp)

## 3. ä½¿ç”¨

### 3.1. åˆ›å»ºæµ‹è¯•è®¡åˆ’

> ğŸ”” æ³¨æ„ï¼š
>
> - åœ¨è¿è¡Œæ•´ä¸ªæµ‹è¯•è®¡åˆ’ä¹‹å‰ï¼Œåº”ä¿å­˜æµ‹è¯•è®¡åˆ’ã€‚
>
> - JMeter çš„æµ‹è¯•è®¡åˆ’ä»¥ `.jmx` æ‰©å±•æ–‡ä»¶çš„å½¢å¼ä¿å­˜ã€‚

#### 3.1.1. åˆ›å»ºçº¿ç¨‹ç»„

- åœ¨â€œæµ‹è¯•è®¡åˆ’â€ä¸Šå³é”® ã€æ·»åŠ ã€‘=>ã€çº¿ç¨‹ï¼ˆç”¨æˆ·ï¼‰ã€‘=>ã€çº¿ç¨‹ç»„ã€‘ã€‚

- è®¾ç½®çº¿ç¨‹æ•°å’Œå¾ªç¯æ¬¡æ•°

![image-20191024105545736](http://dunwu.test.upcdn.net/snap/jmeter/image-20191024105545736.png!zp)

#### 3.1.2. é…ç½®åŸä»¶

- åœ¨æ–°å»ºçš„çº¿ç¨‹ç»„ä¸Šå³é”® ã€æ·»åŠ ã€‘=>ã€é…ç½®å…ƒä»¶ã€‘=>ã€HTTP è¯·æ±‚é»˜è®¤å€¼ã€‘ã€‚

- å¡«å†™åè®®ã€æœåŠ¡å™¨åç§°æˆ– IPã€ç«¯å£å·

![image-20191024110016264](http://dunwu.test.upcdn.net/snap/jmeter/image-20191024110016264.png!zp)

#### 3.1.3. æ„é€  HTTP è¯·æ±‚

- åœ¨â€œçº¿ç¨‹ç»„â€ä¸Šå³é”® ã€æ·»åŠ -ã€‘=>ã€å–æ ·å™¨ã€‘=>ã€HTTP è¯·æ±‚ã€‘ã€‚

- å¡«å†™åè®®ã€æœåŠ¡å™¨åç§°æˆ– IPã€ç«¯å£å·ï¼ˆå¦‚æœé…ç½®äº† HTTP è¯·æ±‚é»˜è®¤å€¼å¯ä»¥å¿½ç•¥ï¼‰
- å¡«å†™æ–¹æ³•ã€è·¯å¾„
- å¡«å†™å‚æ•°ã€æ¶ˆæ¯ä½“æ•°æ®ã€æ–‡ä»¶ä¸Šä¼ 

![image-20191024110953063](http://dunwu.test.upcdn.net/snap/jmeter/image-20191024110953063.png!zp)

#### 3.1.4. æ·»åŠ  HTTP è¯·æ±‚å¤´

- åœ¨â€œçº¿ç¨‹ç»„â€ä¸Šå³é”® ã€æ·»åŠ ã€‘=>ã€é…ç½®å…ƒä»¶ã€‘=>ã€HTTP ä¿¡æ¯å¤´ç®¡ç†å™¨ã€‘
- ç”±äºæˆ‘çš„æµ‹è¯•ä¾‹ä¸­ä¼ è¾“çš„æ•°æ®ä¸º json å½¢å¼ï¼Œæ‰€ä»¥è®¾ç½®é”®å€¼å¯¹ `Content-Type`ï¼š`application/json`

![image-20191024111825226](http://dunwu.test.upcdn.net/snap/jmeter/image-20191024111825226.png!zp)

#### 3.1.5. æ·»åŠ æ–­è¨€

- åœ¨â€œçº¿ç¨‹ç»„â€ä¸Šå³é”® ã€æ·»åŠ ã€‘=>ã€æ–­è¨€ã€‘=>ã€ å“åº”æ–­è¨€ ã€‘
- åœ¨æˆ‘çš„æ¡ˆä¾‹ä¸­ï¼Œä»¥ HTTP åº”ç­”çŠ¶æ€ç ä¸º 200 æ¥åˆ¤æ–­è¯·æ±‚æ˜¯å¦æˆåŠŸ

![image-20191024112335130](http://dunwu.test.upcdn.net/snap/jmeter/image-20191024112335130.png!zp)

#### 3.1.6. æ·»åŠ å¯Ÿçœ‹ç»“æœæ ‘

- åœ¨â€œçº¿ç¨‹ç»„â€ä¸Šå³é”® ã€æ·»åŠ ã€‘=>ã€ç›‘å¬å™¨ã€‘=>ã€å¯Ÿçœ‹ç»“æœæ ‘ã€‘
- ç›´æ¥ç‚¹å‡»è¿è¡Œï¼Œå°±å¯ä»¥æŸ¥çœ‹æµ‹è¯•ç»“æœ

![image-20191024113849270](http://dunwu.test.upcdn.net/snap/jmeter/image-20191024113849270.png!zp)

#### 3.1.7. æ·»åŠ æ±‡æ€»æŠ¥å‘Š

- åœ¨â€œçº¿ç¨‹ç»„â€ä¸Šå³é”® ã€æ·»åŠ ã€‘=>ã€ç›‘å¬å™¨ã€‘=>ã€æ±‡æ€»æŠ¥å‘Šã€‘
- ç›´æ¥ç‚¹å‡»è¿è¡Œï¼Œå°±å¯ä»¥æŸ¥çœ‹æµ‹è¯•ç»“æœ

![image-20191024114016424](http://dunwu.test.upcdn.net/snap/jmeter/image-20191024114016424.png!zp)

#### 3.1.8. ä¿å­˜æµ‹è¯•è®¡åˆ’

æ‰§è¡Œæµ‹è¯•è®¡åˆ’å‰ï¼ŒGUI ä¼šæç¤ºå…ˆä¿å­˜é…ç½®ä¸º `jmx` æ–‡ä»¶ã€‚

### 3.2. æ‰§è¡Œæµ‹è¯•è®¡åˆ’

å®˜æ–¹å»ºè®®ä¸è¦ç›´æ¥ä½¿ç”¨ GUI æ¥æ‰§è¡Œæµ‹è¯•è®¡åˆ’ï¼Œè¿™ç§æ¨¡å¼æŒ‡é€‚ç”¨äºåˆ›å»ºæµ‹è¯•è®¡åˆ’å’Œ debugã€‚

æ‰§è¡Œæµ‹è¯•è®¡åˆ’åº”è¯¥ä½¿ç”¨å‘½ä»¤è¡Œæ¨¡å¼ï¼Œè¯­æ³•å½¢å¼å¦‚ä¸‹ï¼š

```bash
jmeter -n -t [jmx file] -l [results file] -e -o [Path to web report folder]
```

æ‰§è¡Œæµ‹è¯•è®¡åˆ’åï¼Œåœ¨ `-e -o` å‚æ•°åæŒ‡å®šçš„ web æŠ¥å‘Šç›®å½•ä¸‹ï¼Œå¯ä»¥æ‰¾åˆ°æµ‹è¯•æŠ¥å‘Šå†…å®¹ã€‚åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ `index.html` æ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹æŠ¥å‘Šï¼š

![image-20191024120233058](http://dunwu.test.upcdn.net/snap/jmeter/image-20191024120233058.png!zp)

## 4. é—®é¢˜

### 4.1. å¦‚ä½•è¯»å–æœ¬åœ° txt/csv æ–‡ä»¶ä½œä¸ºè¯·æ±‚å‚æ•°

å‚è€ƒï¼š[Jmeter è¯»å–æœ¬åœ° txt/csv æ–‡ä»¶ä½œä¸ºè¯·æ±‚å‚æ•°ï¼Œå®ç°æ¥å£è‡ªåŠ¨åŒ–](https://www.jianshu.com/p/3b2d3b643415)

ï¼ˆ1ï¼‰ä¾æ¬¡ç‚¹å‡»ã€æ·»åŠ ã€‘=>ã€é…ç½®å…ƒä»¶ã€‘=>ã€CSV æ•°æ®æ–‡ä»¶è®¾ç½®ã€‘

é…ç½®å¦‚ä¸‹æ‰€ç¤ºï¼š

![image-20191127175820747](http://dunwu.test.upcdn.net/snap/image-20191127175820747.png)

é‡è¦é…ç½®è¯´æ˜ï¼ˆå…¶ä»–é…ç½®æ ¹æ®å®é™…æƒ…å†µå¡«ï¼‰ï¼š

- æ–‡ä»¶åï¼šè¾“å…¥éœ€è¦å¯¼å…¥çš„æ•°æ®æ–‡ä»¶ä½ç½®ã€‚
- æ–‡ä»¶ç¼–ç ï¼šè®¾ä¸º UTF-8ï¼Œé¿å…ä¹±ç ã€‚
- å˜é‡åç§°ï¼šä½¿ç”¨ `,` åˆ†éš”è¾“å…¥å˜é‡åˆ—è¡¨ã€‚å¦‚æˆªå›¾ä¸­è®¾ç½®äº†ä¸¤ä¸ªå˜é‡ `a` å’Œ `b`

ï¼ˆ2ï¼‰åœ¨ HTTP è¯·æ±‚çš„æ¶ˆæ¯ä½“æ•°æ®ä¸­é…ç½®å‚æ•°

```
[{"a":"${a}","b":"${b}"}]
```

### 4.2. å¦‚ä½•æœ‰åºå‘é€æ•°æ®

ä¾æ¬¡ç‚¹å‡»ã€æ·»åŠ ã€‘=>ã€é€»è¾‘æ§åˆ¶å™¨ã€‘=>ã€äº‹åŠ¡æ§åˆ¶å™¨ã€‘

## 5. å‚è€ƒèµ„æ–™

- [Jmeter å®˜ç½‘](https://jmeter.apache.org/)
- [Jmeter Github](https://github.com/apache/jmeter)
- [Jmeter æ€§èƒ½æµ‹è¯•å…¥é—¨](https://www.cnblogs.com/TankXiao/p/4045439.html)
- [æ˜“ç™¾æ•™ç¨‹ - Jmeter æ•™ç¨‹](https://www.yiibai.com/jmeter)
- [Jmeter è¯»å–æœ¬åœ° txt/csv æ–‡ä»¶ä½œä¸ºè¯·æ±‚å‚æ•°ï¼Œå®ç°æ¥å£è‡ªåŠ¨åŒ–](https://www.jianshu.com/p/3b2d3b643415)
